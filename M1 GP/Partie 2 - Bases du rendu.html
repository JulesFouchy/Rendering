<!doctype html>
<html lang="fr" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-M1 GP/Partie 2 - Bases du rendu" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Partie 2 - Bases du rendu | ICAN - Rendering</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://julesfouchy.github.io/Rendering/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://julesfouchy.github.io/Rendering/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://julesfouchy.github.io/Rendering/M1 GP/Partie 2 - Bases du rendu"><meta data-rh="true" property="og:locale" content="fr"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Partie 2 - Bases du rendu | ICAN - Rendering"><meta data-rh="true" name="description" content="La structure de l&#x27;application"><meta data-rh="true" property="og:description" content="La structure de l&#x27;application"><link data-rh="true" rel="icon" href="/Rendering/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://julesfouchy.github.io/Rendering/M1 GP/Partie 2 - Bases du rendu"><link data-rh="true" rel="alternate" href="https://julesfouchy.github.io/Rendering/M1 GP/Partie 2 - Bases du rendu" hreflang="fr"><link data-rh="true" rel="alternate" href="https://julesfouchy.github.io/Rendering/M1 GP/Partie 2 - Bases du rendu" hreflang="x-default"><link rel="stylesheet" href="/Rendering/assets/css/styles.e7f2a306.css">
<script src="/Rendering/assets/js/runtime~main.50bb1593.js" defer="defer"></script>
<script src="/Rendering/assets/js/main.a43e345a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Rendering/"><div class="navbar__logo"><img src="/Rendering/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Rendering/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/Rendering/Deep dive">Deep dive</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Rendering/M1 GP/Intro">M1 GP</a><a class="navbar__item navbar__link" href="/Rendering/M2 GP/Intro">M2 GP</a><a class="navbar__item navbar__link" href="/Rendering/Ressources">Ressources</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Retour au début de la page" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Rendering/M1 GP/Intro">Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Rendering/M1 GP/Partie 1 - Setup">Partie 1 - Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/Rendering/M1 GP/Partie 2 - Bases du rendu">Partie 2 - Bases du rendu</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Rendering/M1 GP/Partie 3 - Du vrai rendu 3D">Partie 3 - Du vrai rendu 3D</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Fil d&#x27;Ariane"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Page d&#x27;accueil" class="breadcrumbs__link" href="/Rendering/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Partie 2 - Bases du rendu</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Sur cette page</button></div><div class="theme-doc-markdown markdown"><header><h1>Partie 2 - Bases du rendu</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="la-structure-de-lapplication">La structure de l&#x27;application<a href="#la-structure-de-lapplication" class="hash-link" aria-label="Lien direct vers La structure de l&#x27;application" title="Lien direct vers La structure de l&#x27;application">​</a></h2>
<p>Pour l&#x27;instant dans <code>src/main.cpp</code> vous avez ceci :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;opengl-framework/opengl-framework.hpp&quot;</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Inclue la librairie qui va nous servir à faire du rendu</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Initialisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;TPs de Rendering&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// On crée une fenêtre et on choisit son nom</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">maximize_window</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// On peut la maximiser si on veut</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">window_is_open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Rendu à chaque frame</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La boucle <code>while</code> est ce qu&#x27;on appelle la <em>boucle de rendu</em> ; chaque itération correspond à <em>une frame</em>, et il faudra y mettre le code dessinant ce qu&#x27;on veut pour cette frame.</p>
<p>En exécutant ce code, vous devriez avoir une fenêtre noire qui s&#x27;ouvre :
<img decoding="async" loading="lazy" src="/Rendering/assets/images/step-00-c5ddc38ab1238e794fb8cc09e8a82681.png" width="1920" height="1030" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="couleur-de-fond">Couleur de fond<a href="#couleur-de-fond" class="hash-link" aria-label="Lien direct vers Couleur de fond" title="Lien direct vers Couleur de fond">​</a></h2>
<p>Pour commencer très simplement on peut choisir la couleur de fond, au début de la boucle de rendu :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">glClearColor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Choisis la couleur à utiliser. Les paramètres sont R, G, B, A avec des valeurs qui vont de 0 à 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">glClear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GL_COLOR_BUFFER_BIT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Exécute concrètement l&#x27;action d&#x27;appliquer sur tout l&#x27;écran la couleur choisie au-dessus</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-01-136504958c3bdfddaee41c47910ec272.png" width="1920" height="1030" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Note</div><div class="admonitionContent_BuS1"><p>En plus de choisir la couleur, l&#x27;opération <code>glClear(GL_COLOR_BUFFER_BIT)</code> est très importante car elle reset l&#x27;image entre deux frames. Sans elle, les objets dessinés ne disparaissent pas d&#x27;une frame à l&#x27;autre (ce qui peut permettre des effets artistiques intéressants, mais est embêtant pour un rendu &quot;classique&quot;). Vous pourrez essayer ça <a href="#exercice--faire-bouger-le-carr%C3%A9">un peu plus tard</a> quand nous saurons dessiner des objets qui bougent.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="opengl">OpenGL<a href="#opengl" class="hash-link" aria-label="Lien direct vers OpenGL" title="Lien direct vers OpenGL">​</a></h2>
<p>Nous utilisons l&#x27;API <strong>OpenGL</strong> pour communiquer avec la carte graphique. Il en existe d&#x27;autres, mais elles sont soit plus difficiles à apprendre (Vulkan, WebGPU), soit spécifiques à un OS (DirectX pour Windows, Metal pour Mac).</p>
<p>Si jamais vous cherchez de l&#x27;aide sur Internet ou ChatGPT, pensez à bien préciser OpenGL dans votre recherche. Et sinon, vous trouverez la documentation de toutes les fonctions OpenGL sur <a href="https://docs.gl/" target="_blank" rel="noopener noreferrer">docs.gl</a>.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>Tout ce qui commence par <code>gl::</code> (comme <code>gl::init()</code>) ne fait pas partie de l&#x27;API OpenGL de base, mais d&#x27;un wrapper que je vous fournis pour vous simplifier la vie. Par contre ce qui commence par <code>gl</code> (comme <code>glClearColor</code>) fait partie de l&#x27;API OpenGL officielle.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mesh">Mesh<a href="#mesh" class="hash-link" aria-label="Lien direct vers Mesh" title="Lien direct vers Mesh">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="vertex-buffer-et-premier-triangle">Vertex Buffer et Premier Triangle<a href="#vertex-buffer-et-premier-triangle" class="hash-link" aria-label="Lien direct vers Vertex Buffer et Premier Triangle" title="Lien direct vers Vertex Buffer et Premier Triangle">​</a></h3>
<p>Nous allons maintenant dessiner notre premier objet ! Pour décrire notre objet à la carte graphique, nous utilisons un <strong>mesh</strong>, c&#x27;est-à-dire une longue liste de triangles qui, mis bout-à-bout, dessinent notre forme en 3D :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/mesh-6d2a9d063c52d08731e62a56997d63ab.png" width="619" height="638" class="img_ev3q"></p>
<p>Pendant l&#x27;initialisation nous pouvons créer un objet de type <code>gl::Mesh</code> :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> triangle_mesh </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Mesh</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">vertex_buffers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layout </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">VertexAttribute</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Position2D</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*Index de l&#x27;attribut dans le shader, on en reparle juste après*/</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Position2D du 1er sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Position2D du 2ème sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token number" style="color:#36acaa">0.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1.f</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Position2D du 3ème sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>que nous allons ensuite dessiner à chaque frame dans la boucle de rendu :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">bind_default_shader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// On a besoin qu&#x27;un shader soit bind (i.e. &quot;actif&quot;) avant de draw(). On en reparle dans la section d&#x27;après.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">triangle_mesh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">draw</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// C&#x27;est ce qu&#x27;on appelle un &quot;draw call&quot; : on envoie l&#x27;instruction à la carte graphique de dessiner notre mesh.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-02-b55694e2af3ed818b7ecd2bbb62f8a85.png" width="1920" height="1030" class="img_ev3q"></p>
<p>Il y a déjà plein de chose à dire ! Quand on crée un mesh, on lui passe un <strong>vertex buffer</strong> :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">vertex_buffers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layout </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">VertexAttribute</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Position2D</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*Index de l&#x27;attribut dans le shader, on en reparle juste après*/</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Position2D du 1er sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Position2D du 2ème sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token number" style="color:#36acaa">0.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1.f</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Position2D du 3ème sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Un <em>vertex buffer</em> c&#x27;est le tableau qui contient toutes les données décrivant notre mesh : position des sommets des triangles, mais également plein d&#x27;autres données optionnelles : couleur, normale, coordonnée de texture (UV), etc.<br>
En fait c&#x27;est nous qui décidons quoi mettre dans ce buffer, puis que faire de ces données quand on code le vertex shader (que nous verrons plus tard). Pour faire du rendu classique on utilise généralement position + normales + UV. Mais on peut aussi imaginer d&#x27;autres usages plus créatifs et rajouter toutes les données dont on pourrait avoir besoin pour un effet précis.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>Un usage original : on peut stocker la distance au tronc sur chaque vertex des branches et feuilles des arbres. Cette distance est ensuite utilisée pour calculer à quel point la branche peut ployer sous l&#x27;effet du vent. (La partie attachée au tronc ne doit pas bouger, et plus on s&#x27;en éloigne plus on peut bouger librement).<br>
Stocker cette distance dans le vertex buffer évite de la recalculer à chaque frame : c&#x27;est beaucoup plus optimisé.</p><p><a href="https://youtu.be/MKX45_riWQA?t=1085" target="_blank" rel="noopener noreferrer">C&#x27;est utilisé dans God of War par exemple :</a>
<img decoding="async" loading="lazy" src="/Rendering/assets/images/distance_tronc-453da9c5dba4d7f7406bf9f763cb7520.png" width="1920" height="1080" class="img_ev3q"></p></div></div>
<p>Décrire ce vertex buffer se passe en deux étapes : son <strong>layout</strong> et ses <strong>data</strong>.<br>
Le <code>layout</code> indique comment <code>data</code> est structuré : dans notre exemple on a juste des positions 2D qui s&#x27;enchaînent, mais ça pourrait aussi être des positions 3D, et on pourrait aussi avoir d&#x27;autres attributs dans le même tableau <code>data</code>, par exemple des coordonnées de texture, comme on verra <a href="/Rendering/M1 GP/TODO">plus tard</a>. Pour chaque <em>attribut</em> du layout, il faut préciser son <em>index</em> (<code>0</code> dans notre cas), une information qui nous servira plus tard pour récupérer l&#x27;attribut du côté du <em>shader</em>.</p>
<p>Vous remarquerez aussi que <code>vertex_buffers</code> est un tableau de vertex buffers ! Il est en effet possible d&#x27;avoir plusieurs vertex buffers, par exemple un qui stocke les positions, et un autre qui stocke les normales. Ça revient au même que de mettre tous les attributs dans le même vertex buffer, mais ça peut avoir des performances soit meilleures soit pires, en fonction des situations. C&#x27;est une question un peu compliquée dont nous ne soucierons pas, et nous utiliserons simplement ce qui est le plus pratique pour nous.</p>
<p>Enfin, dans <code>data</code> nous mettons nos positions 2D :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Position2D du 1er sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Position2D du 2ème sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token number" style="color:#36acaa">0.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1.f</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Position2D du 3ème sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Le système de coordonnées marche ainsi : <strong>x et y vont toujours de -1 à 1</strong>. Ainsi, <code>x = -1</code> représente toujours le côté gauche de la fenêtre, et <code>y = 1</code> représente toujours le haut de la fenêtre. Vous remarquerez donc que quand vous redimensionnez la fenêtre, le triangle se &quot;déforme&quot; pour continuer à remplir toute la fenêtre. Ce n&#x27;est généralement pas ce qu&#x27;on veut, et nous verrons comment remédier à ça <a href="#envoyer-des-param%C3%A8tres-au-shader--les-uniforms">plus tard</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="renderdoc">RenderDoc<a href="#renderdoc" class="hash-link" aria-label="Lien direct vers RenderDoc" title="Lien direct vers RenderDoc">​</a></h3>
<p>Avant d&#x27;aller plus loin, nous allons commencer à découvrir RenderDoc, un super outil qui nous permettra de débuguer si jamais notre rendu ne se fait pas comme on voudrait.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>Si jamais vous avez besoin de RenderDoc dans Unreal ou Unity, c&#x27;est possible ! Vous pouvez ouvrir ces moteurs directement dans RenderDoc, mais même encore mieux il y a <a href="https://docs.unrealengine.com/4.27/en-US/TestingAndOptimization/PerformanceAndProfiling/RenderDoc/" target="_blank" rel="noopener noreferrer">un plugin RenderDoc pour Unreal</a>, et le <a href="https://youtu.be/4N8GxCeolzM" target="_blank" rel="noopener noreferrer">Frame Debugger pour Unity</a> qui est un équivalent de RenderDoc intégré directement dans Unity.</p></div></div>
<p>La première chose à faire quand vous ouvrez RenderDoc, c&#x27;est d&#x27;aller dans l&#x27;onglet <code>Launch Application</code> pour choisir l&#x27;exécutable à débuguer (qui va se trouver dans le dossier de votre projet, et le sous-dossier build. Il devrait s&#x27;appeler <code>TPs-Rendering.exe</code>):</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/renderdoc-01-e445b887989532c81f26f491e9773263.png" width="1920" height="1030" class="img_ev3q"></p>
<p>Une fois que s&#x27;est fait, vous pouvez cliquer sur <code>Launch</code> :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/renderdoc-02-55fe7dec86cb399229cef2fee5e1c533.png" width="1920" height="1030" class="img_ev3q"></p>
<p>qui va lancer votre application en &quot;mode RenderDoc&quot; :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/renderdoc-03-ddcd98d0f4b3eb3e782450ac08c50540.png" width="1920" height="1030" class="img_ev3q"></p>
<p>Vous pouvez alors faire <kbd>F12</kbd> pour capturer une frame, puis fermer l&#x27;application, et RenderDoc va vous permettre d&#x27;inspecter la frame que vous venez de capturer :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/renderdoc-04-a9199795ebe29acaed9cf942eb8edbb5.png" width="1920" height="1030" class="img_ev3q"></p>
<p>La première chose à regarder, c&#x27;est la timeline sur le côté, qui indique toutes les opérations OpenGL qui ont été exécutées pendant la frame. Vous pouvez cliquer sur chacune d&#x27;elle, et voir le rendu à ce moment là de la frame :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/renderdoc-05-eb2cb960641c81751011019664418bf6.png" width="1920" height="1030" class="img_ev3q"></p>
<p>Dans notre cas c&#x27;est très simple, il y a la couleur de fond qui est faite avec <code>glClear</code>, puis le draw call de notre mesh avec <code>glDrawArrays</code> (le 3 indique qu&#x27;il y avait 3 sommets dans notre vertex buffer).</p>
<p>Ensuite on peut inspecter chaque étape du rendu en cliquant dessus. Ce qui va nous intéresser c&#x27;est le draw call de notre mesh, donc cliquez sur l&#x27;étape <code>glDrawArrays</code>.</p>
<p>La première chose à faire, si typiquement votre mesh ne s&#x27;affiche pas, c&#x27;est d&#x27;aller dans <code>Overlay</code>, et de sélectionner <code>Highlight Drawcall</code>. Ça va indiquer là où votre mesh a atterri à l&#x27;écran.</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/renderdoc-06-8eb7946002c4dcd9aa15e0030234dfc9.png" width="1920" height="1030" class="img_ev3q"></p>
<p>Si vous voyez bien votre mesh en magenta dans le draw call, mais qu&#x27;ensuite le triangle ne s&#x27;affiche pas, c&#x27;est déjà une très bonne information ! Dans ce cas vous pouvez ensuite passer le mode d&#x27;overlay en <code>Depth Test</code>, puis <code>Stencil Test</code>, puis <code>Backface Cull</code>. Si l&#x27;un d&#x27;eux affiche votre mesh en rouge, c&#x27;est que cette étape du rasterizer a décidé de skipper votre mesh. Nous reparlerons de ces étapes plus tard (<a href="#depth-buffer">Depth Test</a>, <a href="/Rendering/M1 GP/TODO">Stencil Test</a>, <a href="/Rendering/M1 GP/TODO">Backface Culling</a>). Sinon, si tout est vert mais que votre mesh ne s&#x27;affiche quand même pas, c&#x27;est probablement au niveau du fragment shader qu&#x27;il y a un problème.</p>
<p>Si à l&#x27;inverse dès l&#x27;overlay <code>Highlight Drawcall</code> vous ne voyez pas votre mesh, alors c&#x27;est le mesh lui-même qui a un problème. Vous pouvez alors aller dans l&#x27;onglet <code>Mesh Viewer</code> :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/renderdoc-07-25c6dadd5f6a40cf8eefba1546db0031.png" width="1920" height="1030" class="img_ev3q"></p>
<p>Ici vous avez plein d&#x27;informations : d&#x27;abord la vue <code>VS In</code> vous montre votre mesh tel qu&#x27;il était avant le vertex shader :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/renderdoc-08-27424ba7949f835d127aab6b8dce94d8.png" width="1920" height="1030" class="img_ev3q"></p>
<p>Si votre mesh apparaît bien ici, tant mieux ! Et sinon, c&#x27;est probablement que votre vertex buffer n&#x27;est pas bon ! Vous pouvez inspecter votre vertex buffer dans la vue <code>VS Input</code>, et regarder si il y a des valeurs bizarres / pas assez de vertexs / un layout qui ne correspond pas à ce que vous pensiez avoir spécifié, etc. Dans cet example, on voit que tout va bien, et on retrouve les valeurs qu&#x27;on avait mises dans notre vertex buffer :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/renderdoc-09-0c2ed4bc27d6f257fdac2dbb7db84450.png" width="1920" height="1030" class="img_ev3q"></p>
<p>Ensuite, vous pouvez aller voir dans <code>VS Out</code> l&#x27;état de votre mesh après le vertex shader. Dans les sections suivantes nous appliquerons des transformations au mesh dans le vertex shader (déplacement, caméra, etc.), et vous pourrez voir le résultat ici :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/renderdoc-10-6f2bbbb7cc326a403dd6c363d6c7e4ff.png" width="1920" height="1030" class="img_ev3q"></p>
<p>Et une fois de plus, si vous avez besoin d&#x27;inspecter les valeurs précises, elles sont toutes dans la vue <code>VS Output</code> :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/renderdoc-11-6bc65faf7f71db7d1268480e3defd1c1.png" width="1920" height="1030" class="img_ev3q"></p>
<p>RenderDoc permet encore beaucoup d&#x27;autres choses, mais vous avez vu l&#x27;essentiel qui vous sauvera 99% du temps !</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dessiner-un-rectangle">Dessiner un rectangle<a href="#dessiner-un-rectangle" class="hash-link" aria-label="Lien direct vers Dessiner un rectangle" title="Lien direct vers Dessiner un rectangle">​</a></h3>
<p>Maintenant, à vous de jouer ! Modifiez le code qui crée votre mesh afin d&#x27;avoir non plus un triangle, mais un rectangle qui prendra la moitié de l&#x27;écran. Il vous faudra dessiner deux triangles, et donc indiquer six sommets dans le vertex buffer.</p>
<p>Si vous avez un problème de rendu, pensez à aller voir dans RenderDoc ce qu&#x27;il se passe !</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-04-32d16a71c191fdd4e69ad9df4d41ad14.png" width="1920" height="1030" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="index-buffer">Index buffer<a href="#index-buffer" class="hash-link" aria-label="Lien direct vers Index buffer" title="Lien direct vers Index buffer">​</a></h3>
<p>Vous avez peut-être remarqué une chose en faisant le vertex buffer du rectangle, c&#x27;est que vous avez dû écrire certains sommets deux fois ! (Une fois pour dessiner le premier triangle, puis une deuxième fois pour le deuxième triangle). Et d&#x27;ailleurs, six sommets pour un rectangle ça fait beaucoup, 4 devraient suffire !<br>
C&#x27;est un problème qui devient d&#x27;autant plus embêtant que sur un vrai mesh les sommets sont parfois partagés par bien plus que deux triangles, et donc doivent être dupliqués plein de fois, ce qui augmente considérablement la taille du mesh.</p>
<p>Heureusement, ce problème a une solution : l&#x27;<strong>index buffer</strong> !</p>
<p>Quand on crée notre <code>gl::Mesh</code> on peut, en plus du vertex buffer, spécifier un index buffer :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> rectangle_mesh </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Mesh</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">vertex_buffers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layout </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">VertexAttribute</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Position2D</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0.5f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0.5f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Position2D du 1er sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">0.5f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0.5f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Position2D du 2ème sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">0.5f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">0.5f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Position2D du 3ème sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0.5f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">0.5f</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Position2D du 4ème sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index_buffer   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Indices du premier triangle : on utilise le 1er, 2ème et 3ème sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Indices du deuxième triangle : on utilise le 1er, 3ème et 4ème sommet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Les indices dans l&#x27;index buffer vont par 3, et décrivent un triangle en indiquant quels sommets prendre dans le vertex buffer.</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-04-32d16a71c191fdd4e69ad9df4d41ad14.png" width="1920" height="1030" class="img_ev3q"></p>
<p>Le rendu est exactement le même, mais notre vertex buffer est plus simple à écrire, et plus léger pour l&#x27;ordinateur !</p>
<p>Vous allez pouvoir tester d&#x27;écrire vous-même un index buffer <a href="#cube">quand vous ferez un cube</a>, mais avant cela il nous manque quelques étapes pour passer en 3D !</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="shader">Shader<a href="#shader" class="hash-link" aria-label="Lien direct vers Shader" title="Lien direct vers Shader">​</a></h2>
<p>Un <strong>Shader</strong> est un programme exécuté par la carte graphique. Il existe deux principaux types de shaders :</p>
<ul>
<li>Le <strong>Vertex Shader</strong> qui prend un sommet dans notre vertex buffer et le modifie (déplacement, application de la perspective 3D, etc.)</li>
<li>Le <strong>Fragment Shader</strong> qui prend un pixel de notre triangle et le colorie (en fonction de son matériau, de la lumière, etc.)</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>Il existe aussi les <strong>Compute Shaders</strong> qui sont plus génériques et prennent n&#x27;importe quel type de buffer et le modifient. Ils sont très utilisés pour faire des simulations sur GPU (particules, fluides, vêtements, etc.).</p></div></div>
<p>Pour créer un shader, il vous suffit de faire, dans l&#x27;initialisation :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> shader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Shader</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">vertex   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">ShaderSource</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">File</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;res/vertex.glsl&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fragment </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">ShaderSource</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">File</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;res/fragment.glsl&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>et de créer les deux fichiers correspondants, dans le dossier <em>res</em> :</p>
<div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">res/vertex.glsl</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">version</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">410</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">location </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec2</span><span class="token plain"> in_position</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gl_Position </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in_position</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">res/fragment.glsl</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">version</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">410</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">out</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec4</span><span class="token plain"> out_color</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    out_color </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>IMPORTANT</div><div class="admonitionContent_BuS1"><p>Tous les assets (shader, texture, modèle 3D, etc.) doivent être mis dans le dossier <code>res</code>, <strong>et pas un autre</strong>, car ce dossier est copié pour être mis à côté de l&#x27;exe dans le dossier build. (C&#x27;est fait dans le CMakeLists.txt, par la ligne <code>gl_target_copy_folder(${PROJECT_NAME} res)</code>). Si jamais vous vouliez renommer le dossier <em>res</em> ou en ajouter un autre, il faudrait bien penser à aller modifier le CMakeLists.txt !</p></div></div>
<p>Puis pour utiliser ce shader à la place du shader par défaut, remplacez la ligne <code>gl::bind_default_shader();</code> par <code>shader.bind();</code> :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-04-32d16a71c191fdd4e69ad9df4d41ad14.png" width="1920" height="1030" class="img_ev3q"></p>
<p>Le rendu n&#x27;a toujours pas changé, car les shaders que je vous ai donnés sont équivalents aux shaders par défaut qu&#x27;on utilisait jusque là. Mais ça ne saurait tarder, nous allons maintenant pouvoir modifier nos shaders comme on veut ! Mais avant tout, quelques explications :</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="glsl">GLSL<a href="#glsl" class="hash-link" aria-label="Lien direct vers GLSL" title="Lien direct vers GLSL">​</a></h3>
<p>Déjà, le GLSL est le langage utilisé pour écrire des shaders. Il ressemble très fort à du C, avec en plus quelques fonctions et types très souvent utilisés en rendu 3D : vecteurs (<code>vec2</code>, <code>vec3</code>, <code>vec4</code>), matrices (<code>mat2</code>, <code>mat3</code>, <code>mat4</code>), et fonctions géométriques (produit scalaire <code>dot(v1, v2)</code>, normalisation d&#x27;un vecteur <code>normalize(v)</code>, etc.).</p>
<p>Chaque shader doit commencer par une indication de la version utilisée (<code>#version 410</code>). Nous utilisons la 410, qui est la dernière supportée par MacOS. (Et sinon elles vont jusqu&#x27;à 460, mais il n&#x27;y a aucune différence en ce qui nous concerne).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="vertex-shader">Vertex Shader<a href="#vertex-shader" class="hash-link" aria-label="Lien direct vers Vertex Shader" title="Lien direct vers Vertex Shader">​</a></h3>
<p>Le vertex shader commence par une déclaration des attributs :</p>
<div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">location </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec2</span><span class="token plain"> in_position</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ces attributs doivent correspondre au layout de notre vertex buffer :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">vertex_buffers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layout </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">VertexAttribute</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Position2D</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*Index de l&#x27;attribut dans le shader*/</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Le <code>layout(location = 0)</code> correspond à l&#x27;index <code>0</code> spécifié pour <code>gl::VertexAttribute::Position2D</code>, et le type <code>vec2</code> vient du fait que nos positions 2D sont des vecteurs à deux composantes (si on utilisait des positions 3D, il faudrait mettre <code>vec3</code>). Le nom <code>in_position</code> est libre et vous pouvez mettre ce que vous voulez.</p>
<p>Ensuite, dans la fonction <code>main()</code> on assigne la variable <code>gl_Position</code>, qui est une variable spéciale indiquant à OpenGL la position finale du vertex (ce qui correspond au <code>VS Out</code> qu&#x27;on avait vu dans RenderDoc).</p>
<p>En guise de premier exercice, vous pouvez déplacer le rectangle via le vertex shader, par exemple de <code>0.4</code> en x et en y :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-05-aec1a47c27f10ec482a85e3f1da45c30.png" width="1920" height="1030" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fragment-shader">Fragment Shader<a href="#fragment-shader" class="hash-link" aria-label="Lien direct vers Fragment Shader" title="Lien direct vers Fragment Shader">​</a></h3>
<p>Le fragment shader commence par</p>
<div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">out</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec4</span><span class="token plain"> out_color</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>qui déclare la variable de sortie : ce qu&#x27;on assigne à cette variable correspondra à la couleur du pixel à l&#x27;écran.</p>
<p>Et dans le <code>main()</code> on fait quelque chose de très simple, qui est d&#x27;assigner la même couleur à tous les pixels, sans réfléchir :</p>
<div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">out_color </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Note</div><div class="admonitionContent_BuS1"><ul>
<li>La syntaxe <code>vec4(1.)</code> est un raccourci pour <code>vec4(1., 1., 1., 1.)</code>. On peut même faire des choses comme <code>vec4(vec3(0.5), 1.)</code>, qui revient à faire <code>vec4(0.5, 0.5, 0.5, 1.)</code>.</li>
<li>Les composantes R, G, B et A des couleurs vont de 0 à 1, donc <code>vec3(1., 1., 1.)</code> correspond à mettre le maximum de rouge, vert et bleu, donc du blanc pur.</li>
</ul></div></div>
<p>En guise de premier exercice, vous pouvez changer la couleur du rectangle :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-06-be66a8febb2dd65bff9034023f9e93ea.png" width="1920" height="1030" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="envoyer-des-paramètres-au-shader--les-uniforms">Envoyer des paramètres au shader : les uniforms<a href="#envoyer-des-paramètres-au-shader--les-uniforms" class="hash-link" aria-label="Lien direct vers Envoyer des paramètres au shader : les uniforms" title="Lien direct vers Envoyer des paramètres au shader : les uniforms">​</a></h3>
<p>Pour que nos shaders deviennent intéressants, il faut leur envoyer plus de données en entrée. On peut soit rajouter des attributs dans le vertex buffer (couleur, UV, normale, etc.), <a href="/Rendering/M1 GP/TODO">ce que nous verrons plus tard</a> ; soit envoyer des paramètres appelés <code>uniforms</code>. Une variable uniforme se déclare ainsi dans le shader, au-dessus du <code>main()</code> :</p>
<div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">uniform</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec2</span><span class="token plain"> nom_de_votre_variable_uniforme</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Vous pouvez mettre le type que vous voulez, et le nom que vous voulez</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>puis peut s&#x27;utiliser dans votre shader comme vous le voulez, comme n&#x27;importe quelle variable normale.</p>
<p>Pour assigner la valeur d&#x27;une variable uniforme, cela se fait dans votre code C++, après avoir bind le shader :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set_uniform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;nom_de_votre_variable_uniforme&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> glm</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">vec2</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3.f</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>On utilise la librairie <code>glm</code> pour avoir des types vecteur et matrice comme en glsl : <code>glm::vec2</code>, <code>glm::vec3</code>, <code>glm::vec4</code>, <code>glm::mat2</code>, <code>glm::mat3</code>, <code>glm::mat4</code>, etc.</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Note</div><div class="admonitionContent_BuS1"><p>Une variable <code>uniform</code> s&#x27;appelle ainsi car elle est uniforme pour un draw call : ça sera la même pour tous les vertexs et pour tous les pixels lors d&#x27;un appel donné à <code>mesh.draw()</code>.<br>
Si on voulait une valeur qui est différente pour chaque vertex, il faudrait passer par un attribut de vertex.</p></div></div>
<p>On peut par exemple utiliser les uniforms pour régler <a href="#vertex-buffer-et-premier-triangle">notre problème de taille de rectangle qui suit la fenêtre</a>. Pour cela, nous allons passer au shader <strong>l&#x27;aspect ratio</strong> de la fenêtre (i.e. <code>largeur / hauteur</code>), et corriger la position en x de nos vertexs en fonction du ratio.</p>
<ul>
<li>Déclarez une uniform <code>aspect_ratio</code> de type <code>float</code> dans le vertex shader</li>
<li>Divisez le x de la position de votre vertex par <code>aspect_ratio</code></li>
<li>Côté C++, passez la uniform au shader (Vous pouvez obtenir l&#x27;aspect ratio de la fenêtre avec <code>gl::framebuffer_aspect_ratio()</code>)</li>
</ul>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-07-09faf623d94c1e38c689b37b81031ee2.png" width="1920" height="1030" class="img_ev3q">
<em>Enfin un carré qui reste carré peu importe la taille de la fenêtre !</em></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>On pourrait se dire qu&#x27;il suffisait de créer un nouveau vertex buffer avec des positions qui prennent en compte l&#x27;aspect ratio, et de recréer le buffer à chaque fois que l&#x27;aspect ratio change. Mais ça impliquerait de modifier potentiellement les millions de vertexs de notre mesh, ce qui prendrait beaucoup de temps. Alors que le vertex shader lui va faire ça en un rien de temps : c&#x27;est la puissance de la carte graphique, qui peut traiter tous les sommets en parallèle extrêmement vite !</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exercice--faire-bouger-le-carré">Exercice : Faire bouger le carré<a href="#exercice--faire-bouger-le-carré" class="hash-link" aria-label="Lien direct vers Exercice : Faire bouger le carré" title="Lien direct vers Exercice : Faire bouger le carré">​</a></h3>
<p>Vous pouvez utiliser <code>gl::time_in_seconds()</code> pour récupérer le temps, l&#x27;envoyer au shader, et vous en servir pour faire bouger le carré. Le plus simple est de le faire aller en ligne droite, mais vous pouvez aussi (bonus) le faire aller et revenir, ou tourner en rond :</p>
<table><thead><tr><th><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-08-00-c0e65cb9588307a51111ea48152fff7e.gif" width="1905" height="988" class="img_ev3q"></th><th><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-08-01-28f906bc6dad429bc9985f1a3bd99be0.gif" width="1905" height="988" class="img_ev3q"></th><th><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-08-02-bc286bb8463c7ba6d7f6d9c304dbc3c0.gif" width="1905" height="988" class="img_ev3q"></th></tr></thead></table>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>Maintenant qu&#x27;on a un objet qui bouge, on peut enfin tester ce qu&#x27;il se passe quand on enlève la ligne <code>glClear(GL_COLOR_BUFFER_BIT);</code>. Je vous laisse essayer !</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bonus--effet-de-fade">Bonus : effet de fade<a href="#bonus--effet-de-fade" class="hash-link" aria-label="Lien direct vers Bonus : effet de fade" title="Lien direct vers Bonus : effet de fade">​</a></h3>
<p>Vous avez toutes les cartes en main pour faire cet effet de fade, alors je vous laisse chercher comment faire 😉</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Info</div><div class="admonitionContent_BuS1"><p>Vous aurez probablement besoin d&#x27;utiliser de la transparence à un moment, qui nécessite d&#x27;être activée, au début de l&#x27;initialisation, avec :</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">glEnable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GL_BLEND</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">glBlendFuncSeparate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GL_SRC_ALPHA</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GL_ONE_MINUS_SRC_ALPHA</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GL_ONE_MINUS_DST_ALPHA</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GL_ONE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// On peut configurer l&#x27;équation qui mélange deux couleurs, comme pour faire différents blend mode dans Photoshop. Cette équation-ci donne le blending &quot;normal&quot; entre pixels transparents.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-09-abf36406361a4032fa7ce1cf1112af2a.gif" width="1905" height="988" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>Si vous voyez un effet de clignotement, c&#x27;est normal, c&#x27;est dû à la swapchain : en fait il y a deux images qui s&#x27;alternent : l&#x27;une qui est affichée à l&#x27;écran, et l&#x27;autre sur laquelle on est en train de dessiner. (Si on dessinait sur l&#x27;image qui est actuellement affichée à l&#x27;écran, on verrait les pixels se dessiner petit à petit et ça ferait très moche). Pour résoudre ce clignotement, il faudrait faire le rendu de toute notre scène dans une <a href="/Rendering/M1 GP/TODO">render target</a> à part, qu&#x27;on copierait à l&#x27;écran à la fin de chaque frame. Nous verrons cette notion <a href="/Rendering/M1 GP/TODO">plus tard</a>.</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>Il reste une trace qui ne s&#x27;efface pas, c&#x27;est dû à des problèmes d&#x27;arrondi au moment du calcul de la transparence, car chaque canal de couleur est stocké sur un entier à 8 bits seulement (par défaut). En faisant notre rendu sur une <a href="/Rendering/M1 GP/TODO">render target</a> utilisant 16 bits par canal, ça résoudrait le problème.</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>Cet effet dépend du framerate ! Si vous dessinez deux fois plus d&#x27;images par seconde, la trace va s&#x27;effacer deux fois plus vite. Pour éviter cela, il faudrait prendre en compte <code>gl::delta_time_in_seconds()</code>, qui donne le temps écoulé entre deux frames.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="caméra-et-matrices">Caméra et Matrices<a href="#caméra-et-matrices" class="hash-link" aria-label="Lien direct vers Caméra et Matrices" title="Lien direct vers Caméra et Matrices">​</a></h2>
<p>Il est temps de passer en 3D !</p>
<p>Pour cela nous avons besoin de deux informations :</p>
<ul>
<li>Le point de vue, i.e. savoir où on est dans l&#x27;espace, et dans quelle direction on regarde</li>
<li>La projection, pour donner l&#x27;effet de perspective inhérent à la 3D</li>
</ul>
<p>Pour représenter ces deux informations, nous allons utiliser des <strong>matrices</strong>. Une matrice est un objet mathématique qui permet de représenter une transformation géométrique. On applique une matrice à un <strong>vecteur</strong> (point ou direction, en 2D ou en 3D) pour lui appliquer la transformation géométrique représentée par la matrice. Par exemple on peut créer une matrice de rotation qui, quand elle est appliquée à un point, fait tourner ce point.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>Une matrice est un grille de nombre. Par exemple une matrice 3D (<code>mat3</code>) ressemblerait à :</p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>4</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><annotation encoding="application/x-tex">\begin{pmatrix}
1 &amp; 0 &amp; 4 \\
0 &amp; 1 &amp; 2 \\
0 &amp; 0 &amp; 1
\end{pmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.875em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,84c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-92c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em"></span><span class="arraycolsep" style="width:0.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em"></span><span class="arraycolsep" style="width:0.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:0.875em;height:3.600em"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,9
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-144c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span></span></span></span></span><p>Je ne rentrerai pas dans les détails de quels nombres mettre dans la matrice pour représenter quelle transformation, car nous allons utiliser la librairie <code>glm</code> pour créer toutes ces matrices.</p></div></div>
<p>Le gros intérêt des matrices est qu&#x27;on peut les combiner entre elles en les multipliant ! Par exemple si j&#x27;ai une matrice 3D de rotation <code>R</code> et une matrice 3D de translation <code>T</code>, alors <code>R * T</code> est une nouvelle matrice 3D, dont la transformation géométrique est une translation suivie d&#x27;une rotation (<strong>NB :</strong> la transformation de droite est appliquée en première).</p>
<p>On peut ainsi construire une seule matrice finale, représentant la combinaison du point de vue (<strong>view matrix</strong>) et de la projection (<strong>projection matrix</strong>). On peut aussi y rajouter une modification de notre mesh (pour faire tourner le mesh, le translater pour le positionner dans le monde où on veut, etc.) (<strong>model matrix</strong>). Ensuite on envoie cette seule matrice au shader, il l&#x27;applique à la position de nos vertexs, et le tour est joué !</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Attention</div><div class="admonitionContent_BuS1"><p>L&#x27;ordre des matrices a son importance ! <code>R * T</code> est différent de <code>T * R</code>.<br>
<code>T * R</code> est une rotation suivie d&#x27;une translation, ce qui est différent de d&#x27;abord faire la translation puis la rotation, comme vous pourrez le constater <a href="#exercice--model-matrix">dans l&#x27;exercice qui suit</a>.</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>On ne peut pas représenter n&#x27;importe quelle transformation géométrique avec des matrices, seulement celles qui sont affines. Mais c&#x27;est déjà bien assez, car les translations, les rotations et les aggrandisements sont toutes des transformations affines.<br>
Vous pouvez <a href="https://www.geogebra.org/m/tn9jqqdt" target="_blank" rel="noopener noreferrer">tester cette démo interactive</a> pour voir quel genre de transformation géométrique une matrice peut produire, et aussi regarder <a href="https://youtu.be/kYB8IZa5AuE?list=PLZHQObOWTQDPD3MizzM2xVFitgF8hE_ab" target="_blank" rel="noopener noreferrer">cette excellentissime vidéo</a>.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-matrix">View Matrix<a href="#view-matrix" class="hash-link" aria-label="Lien direct vers View Matrix" title="Lien direct vers View Matrix">​</a></h3>
<p>Pour obtenir la <strong>View Matrix</strong> nous allons utiliser une <strong>caméra</strong>, que nous pourrons contrôler pour se déplacer dans le monde :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Dans l&#x27;initialisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> camera </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Camera</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>puis, pour que la caméra puisse réagir aux évènements (clic, déplacement de la souris, etc.), il faut la connecter aux évènements fournis par la librairie gl :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Dans l&#x27;initialisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">set_events_callbacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">camera</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">events_callbacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Une fois que c&#x27;est fait, on peut récupérer la matrice de vue avec :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// À chaque frame</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">glm</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">mat4 </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> view_matrix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> camera</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">view_matrix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p><code>gl::set_events_callbacks()</code> prend un tableau de callbacks, donc on pourrait rajouter nos propres callbacks en plus de ceux de la caméra :</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">set_events_callbacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    camera</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">events_callbacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">on_mouse_pressed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">MousePressedEvent </span><span class="token keyword" style="color:#00009f">const</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cout </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mouse pressed at &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">position</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token char">&#x27;\n&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="projection-matrix">Projection Matrix<a href="#projection-matrix" class="hash-link" aria-label="Lien direct vers Projection Matrix" title="Lien direct vers Projection Matrix">​</a></h3>
<p>Il nous faut encore la matrice de projection. Celle-ci est plus simple et s&#x27;obtient directement grâce à glm :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">glm</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">mat4 </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> projection_matrix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> glm</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">infinitePerspective</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1.f</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*field of view in radians*/</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">framebuffer_aspect_ratio</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*aspect ratio*/</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.001f</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*near plane*/</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(Attention, il faudra inclure le bon fichier de <code>glm</code> au début de <em>main.cpp</em> : <code>#include &quot;glm/ext/matrix_clip_space.hpp&quot;</code>)</p>
<p>Ses différents paramètres sont :</p>
<ul>
<li>Le <strong>field of view</strong> (angle de vue). Vous avez peut-être déjà vu ce paramètre dans des jeux vidéos. Plus il est large, plus on voit une grande partie de la scène à la fois (attention, avec des valeurs trop grande les objets commencent à apparaître déformés), plus il est petit moins on voit une grande portion de la scène, ça zoom. Attention, il est exprimé en radians, donc pour un fov de 45° il faudra écrire <code>glm::radians(45.f)</code>.</li>
<li>L&#x27;<strong>aspect ratio</strong> de la fenêtre. La petite division par aspect_ratio qu&#x27;on avait fait <a href="#envoyer-des-param%C3%A8tres-au-shader--les-uniforms">précédemment</a> pour corriger notre problème de stretch est gérée automatiquement par la matrice de projection, vous pouvez donc enlever cette ligne du vertex shader.</li>
<li>Le <strong>near plane</strong> : à cause de limitations techniques, les objets trop proches de la caméra ne peuvent pas être visibles. Le near plane définit à partir de quelle distance on commence à voir les objets. Plus on le met proche de 0, plus on évitera d&#x27;avoir des objets coupés, mais si on le met trop petit on peut commencer à avoir des erreurs d&#x27;arrondis dans nos calculs entre <code>float</code>, ce qui causerait d&#x27;autres problèmes dans notre rendu.</li>
<li>Le <strong>far plane</strong> : on n&#x27;en a pas ici car on utilise <code>glm::infinitePerspective()</code>, mais si on utilisait <code>glm::perspective()</code> on en aurait un. Similaire au near plane, il définit la distance à partir de laquelle on ne voit plus les objets.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>Il y a aussi un autre type de projection : <strong>la projection orthographique</strong>. Elle ne fait pas intervenir de perspective, donc les objets lointains apparaissent à la même taille que les objets proches. Ce n&#x27;est pas réaliste, mais peut être intéressant pour donner un style au rendu.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="envoyer-au-shader">Envoyer au shader<a href="#envoyer-au-shader" class="hash-link" aria-label="Lien direct vers Envoyer au shader" title="Lien direct vers Envoyer au shader">​</a></h3>
<p>Maintenant qu&#x27;on a ces deux matrices, on peut les multiplier entre elles pour former la <code>view_projection_matrix</code> (⚠ Attention, la view doit s&#x27;appliquer en premier, et la projection en deuxième ! Réfléchissez donc bien à l&#x27;ordre dans lequel vous multipliez vos matrices), et envoyer cette view_projection matrix au shader (déclarez une uniform de type <code>mat4</code>). Enfin, il ne reste plus qu&#x27;à multiplier dans le shader la matrice à la position de nos vertexs :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gl_Position </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> view_projection_matrix </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">vec4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in_position</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>Nos matrices sont des <code>mat4</code> alors qu&#x27;on est en 3D. C&#x27;est parce qu&#x27;on utilise une &quot;astuce&quot; qui sont les <em>coordonnées homogènes</em>, et sans lesquelles on ne pourrait pas faire de translation ni de perspective. C&#x27;est pour ça qu&#x27;on a besoin de rajouter une coordonnée de plus que la dimension de l&#x27;espace. C&#x27;est aussi pour ça qu&#x27;on rajoute un 1 en quatrième coordonnée de nos positions (<code>vec4(in_position, 0., 1.)</code>).</p></div></div>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-10-576c30bd1bbf225712645226564db5c3.gif" width="1905" height="988" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exercice--paramètres-de-la-projection">Exercice : paramètres de la projection<a href="#exercice--paramètres-de-la-projection" class="hash-link" aria-label="Lien direct vers Exercice : paramètres de la projection" title="Lien direct vers Exercice : paramètres de la projection">​</a></h3>
<p>Essayez de changer les paramètres de la matrice de projection (field of view, near plane) et essayez d&#x27;observer la différence de rendu. Essayez aussi d&#x27;utiliser une projection orthographique. (Je vous laisse chercher en ligne comment on fait ça avec glm).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exercice--model-matrix">Exercice : model matrix<a href="#exercice--model-matrix" class="hash-link" aria-label="Lien direct vers Exercice : model matrix" title="Lien direct vers Exercice : model matrix">​</a></h3>
<p>On peut rajouter un troisième matrice à la <code>view_projection_matrix</code>, pour former la <code>model_view_projection_matrix</code> ! (Attention, la model matrix doit s&#x27;appliquer en premier).</p>
<p>Avec <code>glm</code> vous pouvez créer une matrice de rotation avec</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">glm</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">mat4 </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> rotation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> glm</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">rotate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">glm</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">mat4</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">time_in_seconds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*angle de la rotation*/</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> glm</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">vec3</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* axe autour duquel on tourne */</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>et une matrice de translation avec</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">glm</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">mat4 </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> translation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> glm</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">translate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">glm</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">mat4</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> glm</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">vec3</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.f</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* déplacement */</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(Il faudra include <code>#include &quot;glm/ext/matrix_transform.hpp&quot;</code>.)</p>
<p>Créez une matrice modèle qui combine une translation et une rotation, et observez le résultat. Essayez les deux ordres (rotation suivie de translation, et vice-versa) et vous verrez que ce n&#x27;est pas pareil ! L&#x27;ordre a son importance !</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cube">Cube<a href="#cube" class="hash-link" aria-label="Lien direct vers Cube" title="Lien direct vers Cube">​</a></h2>
<p>Maintenant qu&#x27;on peut voir en 3D, il est temps de faire notre premier mesh 3D ! Faites le vertex buffer et l&#x27;index buffer pour un cube. Je vous laisse <a href="#index-buffer">revoir le chapitre dédié au besoin</a>.<br>
Je vous conseille de faire des petits schémas pour ne pas vous y perdre dans les indices, et y aller face par face.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Attention</div><div class="admonitionContent_BuS1"><p>Pensez à modifier aussi votre shader, pour qu&#x27;il reçoive une position 3D et plus 2D.</p></div></div>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-11-ec5eda602e0a1521dd6a508c38e645c6.gif" width="1905" height="988" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="premier-shader-pour-mieux-voir-la-3d">Premier shader pour mieux voir la 3D<a href="#premier-shader-pour-mieux-voir-la-3d" class="hash-link" aria-label="Lien direct vers Premier shader pour mieux voir la 3D" title="Lien direct vers Premier shader pour mieux voir la 3D">​</a></h2>
<p>On a du mal à discerner la 3D sur notre cube monochrome. Nous allons donc changer notre fragment shader pour commencer à un peu mieux voir tout ça.</p>
<p>Une manière très simple va être de passer la position des vertexs du vertex shader vers le fragment shader, puis d&#x27;utiliser ces positions comme des couleurs, afin que chaque vertex ait une couleur différente.</p>
<p>Pour cela dans le vertex shader nous allons déclarer une variable <code>out</code>, qui sera transmise au fragment shader automatiquement :</p>
<div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">res/vertex.glsl</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// À mettre avant le main</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">out</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec3</span><span class="token plain"> vertex_position</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>puis on l&#x27;assigne dans le main :</p>
<div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">res/vertex.glsl</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vertex_position </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> in_position</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>et ensuite dans le fragment shader on déclare un variable <code>in</code> avec le même nom et le même type que la variable <code>out</code> de notre vertex shader :</p>
<div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">res/fragment.glsl</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// À mettre avant le main</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec3</span><span class="token plain"> vertex_position</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>et on peut l&#x27;utiliser dans notre main :</p>
<div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">res/fragment.glsl</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">out_color </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vertex_position</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-12-5bea704238522e94a6b49e1c6c7c3e55.png" width="1920" height="1030" class="img_ev3q"></p>
<p>Si votre cube vous paraît un peu bizarre, c&#x27;est normal, il nous manque encore un Depth Buffer pour faire de la 3D correctement !</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="depth-buffer">Depth Buffer<a href="#depth-buffer" class="hash-link" aria-label="Lien direct vers Depth Buffer" title="Lien direct vers Depth Buffer">​</a></h2>
<p>Le problème avec notre rendu pour l&#x27;instant, c&#x27;est que les triangles se dessinent les uns après les autres et se recouvrent. Et si par malchance c&#x27;est une face arrière du cube qui est dessinée en dernière, alors elle va venir cacher les faces avant qui ont été dessinées avant.</p>
<p>Pour remédier à ça, il faut activer le Depth Test :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// À mettre dans l&#x27;initialisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">glEnable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GL_DEPTH_TEST</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>et clear le depth buffer à chaque frame, tout comme on clear la couleur de l&#x27;écran :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">glClear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GL_COLOR_BUFFER_BIT </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> GL_DEPTH_BUFFER_BIT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Vient remplacer glClear(GL_COLOR_BUFFER_BIT);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-13-a049282c6f0e6f108285b78d53b36a0e.png" width="1920" height="1030" class="img_ev3q"></p>
<p>Et voilà ! Notre premier rendu 3D qui ressemble à peu près à quelque chose ! 🎉</p>
<p>Et qu&#x27;est-ce donc qu&#x27;un Depth Buffer au fait ? C&#x27;est une deuxième image, qui se crée en parallèle de la couleur qu&#x27;on met à l&#x27;écran, et qui stocke la profondeur correspondant à chaque pixel. Ainsi chaque triangle dessine à la fois une couleur à l&#x27;écran (contrôlée par le fragment shader), et aussi une &quot;couleur&quot; dans le depth buffer. Et avant même de dessiner, on vérifie pour chaque pixel si il n&#x27;y avait pas déjà eu quelque chose de dessiné sur ce pixel, et si oui on compare leur profondeur, et on recolorie le pixel avec la nouvelle couleur seulement si il est plus proche de la caméra que l&#x27;objet précédemment dessiné (on obtient cette distance à la caméra justement en allant lire le depth buffer).</p>
<p>On peut aller visualiser notre Depth Buffer dans RenderDoc :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/renderdoc-12-2ee73a6b9a09de7be8a61c3177acd031.png" width="1920" height="1030" class="img_ev3q"></p>
<p>Dans l&#x27;onglet <code>Outputs</code> il y a maintenant deux images : l&#x27;écran normal (<code>Backbuffer Color</code>), et le Depth Buffer (<code>Backbuffer Depth-stencil</code>). (NB : pour y voir quelque chose dans le depth buffer, il faut changer la <code>Range</code>, car comme le cube est très proche il apparaît très blanc dans le depth buffer).</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Remarque</div><div class="admonitionContent_BuS1"><p>On verra un usage créatif du depth buffer pour faire un <a href="/Rendering/M1 GP/TODO">effet de rendu See-Through</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="texture">Texture<a href="#texture" class="hash-link" aria-label="Lien direct vers Texture" title="Lien direct vers Texture">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bonus--textures-procédurales-en-fonction-des-uvs-cf-shadertoy">Bonus : textures procédurales en fonction des uvs, cf. Shadertoy<a href="#bonus--textures-procédurales-en-fonction-des-uvs-cf-shadertoy" class="hash-link" aria-label="Lien direct vers Bonus : textures procédurales en fonction des uvs, cf. Shadertoy" title="Lien direct vers Bonus : textures procédurales en fonction des uvs, cf. Shadertoy">​</a></h3></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pages de documentation"><a class="pagination-nav__link pagination-nav__link--prev" href="/Rendering/M1 GP/Partie 1 - Setup"><div class="pagination-nav__sublabel">Précédent</div><div class="pagination-nav__label">Partie 1 - Setup</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Rendering/M1 GP/Partie 3 - Du vrai rendu 3D"><div class="pagination-nav__sublabel">Suivant</div><div class="pagination-nav__label">Partie 3 - Du vrai rendu 3D</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#la-structure-de-lapplication" class="table-of-contents__link toc-highlight">La structure de l&#39;application</a></li><li><a href="#couleur-de-fond" class="table-of-contents__link toc-highlight">Couleur de fond</a></li><li><a href="#opengl" class="table-of-contents__link toc-highlight">OpenGL</a></li><li><a href="#mesh" class="table-of-contents__link toc-highlight">Mesh</a><ul><li><a href="#vertex-buffer-et-premier-triangle" class="table-of-contents__link toc-highlight">Vertex Buffer et Premier Triangle</a></li><li><a href="#renderdoc" class="table-of-contents__link toc-highlight">RenderDoc</a></li><li><a href="#dessiner-un-rectangle" class="table-of-contents__link toc-highlight">Dessiner un rectangle</a></li><li><a href="#index-buffer" class="table-of-contents__link toc-highlight">Index buffer</a></li></ul></li><li><a href="#shader" class="table-of-contents__link toc-highlight">Shader</a><ul><li><a href="#glsl" class="table-of-contents__link toc-highlight">GLSL</a></li><li><a href="#vertex-shader" class="table-of-contents__link toc-highlight">Vertex Shader</a></li><li><a href="#fragment-shader" class="table-of-contents__link toc-highlight">Fragment Shader</a></li><li><a href="#envoyer-des-paramètres-au-shader--les-uniforms" class="table-of-contents__link toc-highlight">Envoyer des paramètres au shader : les uniforms</a></li><li><a href="#exercice--faire-bouger-le-carré" class="table-of-contents__link toc-highlight">Exercice : Faire bouger le carré</a></li><li><a href="#bonus--effet-de-fade" class="table-of-contents__link toc-highlight">Bonus : effet de fade</a></li></ul></li><li><a href="#caméra-et-matrices" class="table-of-contents__link toc-highlight">Caméra et Matrices</a><ul><li><a href="#view-matrix" class="table-of-contents__link toc-highlight">View Matrix</a></li><li><a href="#projection-matrix" class="table-of-contents__link toc-highlight">Projection Matrix</a></li><li><a href="#envoyer-au-shader" class="table-of-contents__link toc-highlight">Envoyer au shader</a></li><li><a href="#exercice--paramètres-de-la-projection" class="table-of-contents__link toc-highlight">Exercice : paramètres de la projection</a></li><li><a href="#exercice--model-matrix" class="table-of-contents__link toc-highlight">Exercice : model matrix</a></li></ul></li><li><a href="#cube" class="table-of-contents__link toc-highlight">Cube</a></li><li><a href="#premier-shader-pour-mieux-voir-la-3d" class="table-of-contents__link toc-highlight">Premier shader pour mieux voir la 3D</a></li><li><a href="#depth-buffer" class="table-of-contents__link toc-highlight">Depth Buffer</a></li><li><a href="#texture" class="table-of-contents__link toc-highlight">Texture</a><ul><li><a href="#bonus--textures-procédurales-en-fonction-des-uvs-cf-shadertoy" class="table-of-contents__link toc-highlight">Bonus : textures procédurales en fonction des uvs, cf. Shadertoy</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Pour me contacter :</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.com/users/372812330742054914" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="mailto:jules.fouchy@ntymail.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">E-Mail</a></li></ul></div></div></div></footer></div>
</body>
</html>