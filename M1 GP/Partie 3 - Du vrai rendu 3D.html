<!doctype html>
<html lang="fr" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-M1 GP/Partie 3 - Du vrai rendu 3D" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Partie 3 - Du vrai rendu 3D | ICAN - Rendering</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://julesfouchy.github.io/Rendering/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://julesfouchy.github.io/Rendering/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://julesfouchy.github.io/Rendering/M1 GP/Partie 3 - Du vrai rendu 3D"><meta data-rh="true" property="og:locale" content="fr"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Partie 3 - Du vrai rendu 3D | ICAN - Rendering"><meta data-rh="true" name="description" content="Charger un mesh depuis un fichier"><meta data-rh="true" property="og:description" content="Charger un mesh depuis un fichier"><link data-rh="true" rel="icon" href="/Rendering/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://julesfouchy.github.io/Rendering/M1 GP/Partie 3 - Du vrai rendu 3D"><link data-rh="true" rel="alternate" href="https://julesfouchy.github.io/Rendering/M1 GP/Partie 3 - Du vrai rendu 3D" hreflang="fr"><link data-rh="true" rel="alternate" href="https://julesfouchy.github.io/Rendering/M1 GP/Partie 3 - Du vrai rendu 3D" hreflang="x-default"><link rel="stylesheet" href="/Rendering/assets/css/styles.6703b6d1.css">
<script src="/Rendering/assets/js/runtime~main.288c64e8.js" defer="defer"></script>
<script src="/Rendering/assets/js/main.119c15c2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Rendering/"><div class="navbar__logo"><img src="/Rendering/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Rendering/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/Rendering/Deep dive">Deep dive</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Rendering/M1 GP/Intro">M1 GP</a><a class="navbar__item navbar__link" href="/Rendering/M2 GP/Intro">M2 GP</a><a class="navbar__item navbar__link" href="/Rendering/Shaders Unreal/Jour 1/Cours 1">Shaders Unreal</a><a class="navbar__item navbar__link" href="/Rendering/Shaders Blender/Pick and Try">Shaders Blender</a><a class="navbar__item navbar__link" href="/Rendering/Maths/Intro">Maths</a><a class="navbar__item navbar__link" href="/Rendering/Ressources">Ressources</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Retour au début de la page" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Rendering/M1 GP/Intro">Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Rendering/M1 GP/Consignes du rendu">Consignes du rendu</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Rendering/M1 GP/Partie 1 - Setup">Partie 1 - Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Rendering/M1 GP/Partie 2 - Bases du rendu">Partie 2 - Bases du rendu</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/Rendering/M1 GP/Partie 3 - Du vrai rendu 3D">Partie 3 - Du vrai rendu 3D</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Fil d&#x27;Ariane"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Page d&#x27;accueil" class="breadcrumbs__link" href="/Rendering/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Partie 3 - Du vrai rendu 3D</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Sur cette page</button></div><div class="theme-doc-markdown markdown"><header><h1>Partie 3 - Du vrai rendu 3D</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="charger-un-mesh-depuis-un-fichier">Charger un mesh depuis un fichier<a href="#charger-un-mesh-depuis-un-fichier" class="hash-link" aria-label="Lien direct vers Charger un mesh depuis un fichier" title="Lien direct vers Charger un mesh depuis un fichier">​</a></h2>
<p>Pour commencer, nous allons enfin utiliser de vrais modèles 3D. Pour cela, nous allons utiliser la librairie <a href="https://github.com/tinyobjloader/tinyobjloader" target="_blank" rel="noopener noreferrer"><em>tinyobjloader</em></a> qui lit le format de fichier <em>.obj</em> (un format simple de modèle 3D, qui est essentiellement une longue liste de sommets avec positions, UVs, normales, etc.). La librairie est déjà inclue par <em>opengl-framework</em>, vous n&#x27;avez rien à faire de ce côté là.</p>
<p>Il va nous falloir créer un tableau de floats qu&#x27;on va remplir avec les positions, UVs et normales du mesh, et nous allons ensuite utiliser ce tableau comme <code>data</code> pour créer un <code>gl::Mesh</code> :</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">load_mesh</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">filesystem</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">path </span><span class="token keyword" style="color:#00009f">const</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Mesh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// On lit le fichier avec tinyobj</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> reader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tinyobj</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">ObjReader</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ParseFromFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">make_absolute_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">empty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">runtime_error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Failed to read 3D model:\n&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Warning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">empty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cout </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Warning while reading 3D model:\n&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Warning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// On met tous les attributs dans un tableau</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> vertices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">vector</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">float</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> shape </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetShapes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">auto</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> idx </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> shape</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mesh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">indices</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vertices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push_back</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetAttrib</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">vertices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> idx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">vertex_index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vertices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push_back</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetAttrib</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">vertices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> idx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">vertex_index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vertices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push_back</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetAttrib</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">vertices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> idx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">vertex_index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// UV</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vertices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push_back</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetAttrib</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">texcoords</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> idx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">texcoord_index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vertices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push_back</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetAttrib</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">texcoords</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> idx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">texcoord_index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Normale</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vertices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push_back</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetAttrib</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normals</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> idx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normal_index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vertices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push_back</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetAttrib</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normals</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> idx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normal_index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vertices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push_back</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetAttrib</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normals</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> idx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normal_index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// TODO créer et return un gl::mesh, qui utilisera le tableau `vertices` en tant que `data` pour son vertex buffer.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Attention, il faudra bien spécifier le layout pour qu&#x27;il corresponde à l&#x27;ordre des attributs dans le tableau `vertices`.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Complétez la fonction ci-dessus pour construire un mesh à partir du tableau de vertices obtenu grâce à tinyobj. Il vous suffit ensuite de remplacer votre mesh de cube par un mesh loadé avec cette fonction, et le tour est joué ! Pour vos tests, vous pouvez utiliser <a href="/Rendering/assets/files/fourareen-fa4bc93def8c839a6e356b89533490ee.zip" target="_blank">ce modèle 3D</a> et le mettre dans votre dossier <em>res</em>.</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-23-60a996da3d244e1bc650651e8cc943d1.png" width="1920" height="1030" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>astuce</div><div class="admonitionContent_BuS1"><p>Si votre modèle est penché sur le côté au début, c&#x27;est &quot;normal&quot;. Il n&#x27;y a pas de convention universelle pour l&#x27;axe qui pointe vers le haut : certaines utilisent Y, et d&#x27;autres Z. Il faudra donc légèrement modifier les vertexs du mesh au moment du loading afin de faire pointer le bon axe vers le haut.</p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>astuce</div><div class="admonitionContent_BuS1"><p>N&#x27;essayez pas de faire un index buffer, les sommets tels qu&#x27;ils sont donnés par <em>tinyobjloader</em> ont un index buffer différent pour chaque attribut, ce qui n&#x27;est pas supporté par OpenGL. Il faudrait plutôt inspecter tous les sommets pour détecter ceux qui ont les mêmes positions <strong>et</strong> UVs <strong>et</strong> normales et recréer notre propre index buffer à partir de ça.</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Note</div><div class="admonitionContent_BuS1"><p>Il y a aussi un fichier <em>.mtl</em> dans le modèle que je vous ai fourni. Il décrit le matériau de l&#x27;objet, nous en parlerons <a href="/Rendering/M1 GP/TODO">plus tard</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="premier-modèle-déclairage-et-normales">Premier modèle d&#x27;éclairage et Normales<a href="#premier-modèle-déclairage-et-normales" class="hash-link" aria-label="Lien direct vers Premier modèle d&#x27;éclairage et Normales" title="Lien direct vers Premier modèle d&#x27;éclairage et Normales">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="normales">Normales<a href="#normales" class="hash-link" aria-label="Lien direct vers Normales" title="Lien direct vers Normales">​</a></h3>
<p>Nous allons maintenant commencer à éclairer plus ou moins nos objets en fonction des différentes lumières présentes dans la scène. Tout va se passer dans le fragment shader, qui va être responsable de faire ces calculs pour chaque pixel, et d&#x27;atténuer plus ou moins la couleur de base du pixel (appelée <strong>albedo</strong>) en fonction de la quantité de lumière reçue.</p>
<p>Pour faire ces calculs de lumière, nous avons besoin de connaître l&#x27;orientation de notre surface (pour savoir à quel point elle est face à la lumière) et c&#x27;est à ça que servent les <strong>normales</strong> :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/normals-af2aae03b46ad33cee0b221b8fa03a3b.png" width="300" height="234" class="img_ev3q"></p>
<p>La normale est le vecteur perpendiculaire à la surface ; on pourrait le calculer à la volée en connaissant les trois sommets du triangle, mais il est le plus souvent précalculé et stocké dans le vertex buffer. Par exemple dans le <em>.obj</em> que nous utilisons, les normales sont déjà stockées dans le fichier, en plus des positions et des UVs. Rajoutez les normales dans votre vertex buffer, et dans un premier temps pour vérifier qu&#x27;elles sont bonnes, affichez les en tant que couleur de l&#x27;objet :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-24-9720c7b82789d4f7430b2136c42a7e4d.png" width="1920" height="1030" class="img_ev3q"></p>
<p>On peut interpréter les couleurs : RGB = XYZ : en bleu ce sont les normales qui pointent vers Z, i.e. vers le haut. En rouge et vert sont celles qui pointent vers X et Y.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lumière-directionnelle">Lumière directionnelle<a href="#lumière-directionnelle" class="hash-link" aria-label="Lien direct vers Lumière directionnelle" title="Lien direct vers Lumière directionnelle">​</a></h3>
<p>Maintenant il nous faut décrire notre lumière. Nous allons commencer par le type le plus simple, les lumières directionnelles. C&#x27;est une lumière qui éclaire dans une seule direction ; c&#x27;est typiquement le cas du soleil (ou toute autre source très éloignée), dont tous les rayons nous arrivent (quasiment) parallèles :</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAD6CAMAAAC/MqoPAAADAFBMVEUsPlAtP1AtP1EuP1EuQFIvQFIwQlMxQ1QxQ1UyQ1UyRFUzRFYzRVY0Rlc1Rlc2R1g4SVo7TFw9TV49Tl4/UGBAUGBAUGFAUWFBUmJCUmNFVWVHV2dKWWhKWWlKWmlMXGtPXm1PX25RYG9TYXBUYnFVY3JWZXNYZnRYZnVZZ3VbaXddanhea3lgbntjcH1lcn9odIFodYJqd4NteYZve4hyfop0gIx2go53go55hJB7h5J+iZR/ipWAi5aDjZiFkJqHkZuIkpyKlJ6Nl6CPmaKSm6STnKWUnaaXn6iXoKmZoqucpK2epq+fp6+hqbGjq7OmrbWor7eosLersrmttLuvtr2wtr2yub+1u8G3vcO5v8W8wse+xMm+xMrBxszDyc7Eyc7Gy9DIzdLLz9TN0tbQ1NjS1trV2NzX2t7X297a3eDc3+Le4eTf4eTh5Obi5Ofk5ujl5+jm6Orp6+zr7e/s7e/u7/Hw8fPxxA/xxRLxxRXxxhfyxxryyCDyySPyyibyyijzyyvzzC7zzDHzzTTzzjfzzjnz9PX0zzz00D/00EL00UX00kf000r100311FD11VP11Vb11lj111v19vf211722GH22WT22mf22mn222z33G/33HL33XX33nf33nr333344ID44IP44Yb44oj444v44474+Pn55JH55ZT55Zf55pn555z555/66KL66aX66af66qr666367LD6+vv77LP77bb77rj77rv777778MH88MT88cf88sn888z888/89NL99dX99df99tr999399+D9+OP9/f3++eb++ej++uv+++7+/PH+/PT//ff//vn//vz///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACxasTxAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH4gwLCCgw8D61lwAAAAd0RVh0QXV0aG9yAKmuzEgAAAAMdEVYdERlc2NyaXB0aW9uABMJISMAAAAK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" width="250" height="250" class="img_ev3q"></p>
<p>Pour la décrire il nous suffit de donner sa direction, qui sera un <code>vec3</code> normalisé (i.e. de longueur 1). On peut soit la mettre en constante dans le fragment shader <code>const vec3 light_direction = normalize(vec3(0.2, 0.3, -1.));</code>, soit la passer en uniform <code>uniform vec3 light_direction;</code> (ce qui est l&#x27;option la plus courante, car on veut pouvoir changer la direction de notre lumière sans avoir à recréer un nouveau shader à chaque fois).<br>
Une fois que vous avez cette direction, pour mesurer à quel point notre triangle fait face à la lumière (et donc à quel point il est éclairé) nous allons utiliser le <em>produit scalaire</em> (<code>dot(v1, v2)</code> en glsl). Le produit scalaire entre deux vecteurs parfaitement alignés vaut 1 (si les vecteurs sont normalisés), il vaut -1 si les vecteurs sont parfaitement opposés, et il vaut 0 si les vecteurs sont orthogonaux. On peut ensuite multiplier la couleur de notre pixel par le résultat de ce produit scalaire (avec un signe moins), ce qui va nous donner un premier modèle d&#x27;éclairage simpliste : Quand la normale et la direction de la lumière sont parfaitement opposées c&#x27;est l&#x27;éclairage maximal, et on va multiplier par un produit scalaire qui vaut 1, donc conserver toute la couleur du pixel. À l&#x27;inverse quand les vecteurs sont perpendiculaires aucune lumière n&#x27;arrive sur notre surface, et ça correspond bien au fait de multiplier par un produit scalaire qui vaut 0 dans ce cas.</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-25-9afefcdb491b772dac267b45108590b1.png" width="1920" height="1030" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>astuce</div><div class="admonitionContent_BuS1"><p>Pour nos produits scalaires on a besoin que les deux vecteurs soient normalisés, donc pensez bien à <strong>toujours normaliser vos normales</strong> !<br>
Et attention, il y a des petits pièges : par exemple si vos normales sont normalisées dans le vertex shader, et qu&#x27;ensuite vous les passez au fragment shader via une variable <code>in</code> / <code>out</code>, elles ne seront plus normalisées, car l&#x27;interpolation entre les sommets se produit, et la moyenne de vecteurs normalisés n&#x27;est pas nécessairement normalisée.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lumière-ambiante">Lumière ambiante<a href="#lumière-ambiante" class="hash-link" aria-label="Lien direct vers Lumière ambiante" title="Lien direct vers Lumière ambiante">​</a></h3>
<p>Un premier défaut qu&#x27;on peut tout de suite voir c&#x27;est que certaines parties du bateau sont complètement noires, car elles sont à l&#x27;opposé de la lumière. Ce n&#x27;est pas très réaliste, car dans la vraie vie même si on n&#x27;est pas directement exposé à la lumière celle-ci rebondit sur les objets environnants et vient éclairer un peu partout. C&#x27;est ce qui s&#x27;appelle de <strong>l&#x27;illumination globale</strong>. Il y a des techniques pour simuler ça dans les moteurs de jeu, mais ça devient assez complexe. Pour faire simple on peut juste rajouter un terme de <strong>lumière ambiante</strong> qui va faire une approximation de cette illumination globale. Il suffit d&#x27;additionner un petit quelque chose (<code>0.3</code> par exemple) à notre produit scalaire, pour l&#x27;empêcher de tomber jusqu&#x27;à 0 (et aussi, si le produit scalaire devient négatif, il faut le limiter à 0, afin que notre <code>+0.3</code> ait de l&#x27;effet dans toutes les zones noires, et pas seulement dans celles où le produit scalaire est <code>&gt; -0.3</code>).</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-26-5acefb16bd2997bab49f0370c0244218.png" width="1920" height="1030" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lumière-ponctuelle">Lumière ponctuelle<a href="#lumière-ponctuelle" class="hash-link" aria-label="Lien direct vers Lumière ponctuelle" title="Lien direct vers Lumière ponctuelle">​</a></h3>
<p>Un autre type de lumière assez simple est la lumière ponctuelle. Elle est décrite par une position (<code>vec3</code>) et illumine de manière égale dans toutes les directions autour d&#x27;elle. C&#x27;est typiquement le cas des ampoules et autres petites sources de lumière.</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAO8AAAEXCAIAAADKpIQuAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAB0zSURBVHhe7Z1rkFtnecfP/eiy0kq+rOOYkMTXrA1xQjBJbIdwKSROKIGUAi2UwHQmmTKdCZ2BL0w/9EM70xm+wMfkS2lpZxhKgKSBBGYYBoidpLkPid3Yjr3r9e7a693Vrm5H597/c452vZZX671IsvXq+Y1sHR1pj47O+enR/33PqyM5DEOJYYRAqV8zTPfDNjPiwDYz4sA2M+LANjPiwDYz4tDjNp/8wQGZOPCDk/U5bWVFT9fhdROB7rZ5bodfwmPP1e9dBieOHomujxw9EV23hOYatuXpmHm62+Y5Oy7hyQeWb/SO3fuj6/27d0TXV+a5x5qYuhxW/nRLs6aVERAxksajvwpjfvVoPOPJf17eDt7++OHo7w4/vr0+p610+Ol6DsFy86HvfD+ufgs/yxvyyMJK1hAK6jfpVr3sEfN/QPMeeDKaPPKtHdF9K4k1i2aQhpWLWbiKxIIHtW5lBET0ViB5sONbl+QR2vdL73d6RF0UAjfb5AnWrmHlFgFPv+BB7VsZARDL5pM/eKS+3x/93KGFt/d//0T0ET8XRZ584EpKxOHlRL3UP/kLevihJ+YXMLfAJ+hpVstz34vWrr6suefCMzcmkU6sjAiIYTM1/Ii5Grb/+9+JZP7lT+ou//ucHvNR5O3jl36YXwL0iM3Y/vg/xsIs+fBVcvL423S1/4sPRiu3/cEvRqvW+FSdWRkhEC9pUB2r17a5Lo8P7LxY6rbv/EB0fQ10ktVX5chPfhnJOffeW7i2zIoQw+b5Pg3QRR+39Q8KiukXP1jijMSsBqFbgXPduws/mesf7y3r8l0L9dx8EQrAPR9+14DQNs8l0SPf+l69zXexWVgPq6ulFUHluV9E/SYLPlhW2Q/NhxbrCG3zxXZTQzNxQbNwpRz63CVLXKprpJ4g6jT2Ic9/dMytW52V9L+tYGV6ArFtvqQfqw59mq/lWNyhJxYsb015Ze6j41Jg5uXiN6N1KyMG9c84puMs6F+eY07Nha1aZvmIXpuvYer9hwsq6lwLlVklfAaCq0bTw9rIQjwsaVWwzVeV5x5bOCAEIGNwF92qYZsZceDczIgD28yIA9vMiAPbzIgD28yIA9vMiAPbzIgD28yIA9vMiAPbzIgD28yIA9vMiAPbzIgD28yIA9vMiAPbzIgD28yIA9vMiAPbzIgD28yIA9vMiAPbzIgD28yIA9vMiAPbzIgD28yIA9vMiAOfh65lyLIcT/AmvVpwbW4N8yqDhdNMJ2GbW8Dl+rLQVwW2ea00E5eF7jxs85pYWlkWusOwzatnObKy0J2EbV4lDZou7Mdo6NNgoTsG27wallA5hoW+KrDNa6VZ7zIL3XnY5jXRTOUYFrrDsM2rZ2mVY5bzGKZVsM2rAY4uX1MWumPwOI2WMR8keJNeLbre5hWF0ba+WLb5qsNJgxEHrs0towO1+dp5sdcmotl8FV8O23zVES1prGh/M4IhZtK4Ki+qA7V5aRo2BddmQejBCs0fSkAcmxtKUU/tXVY5Rqja3JtCs8rziJY0ek3ohhfYg1l5IQLm5t4RmlVuQMxWYC8IzSpfjpg2A7GFZpUXRVibgahCs8rN6HqbsS9j6rcvpWG+AEKzyksgcm2OEUloVnlpemW0fgc8mH+KNm1SVvmKiF+bYxr2fddVaFZ5OfSKzaB7hWaVl0kP2Qy6UWhWefn0ls2gu4RmlVdEz9kMukVoVnml9EqfxuUsdOUa3Ais8iroxdoccy37wSqvjt6tzUvjeZ6madg4QFHopqoZmI+tFcqS64VknCph28Xe4f/5aVSIINqoilyf4weS63oJU/MDLE0OAt/AfaEvYREAC5XlMAgcxzETKcy4xj83rlnY5qbAYPwPpz3Pwf+W7STMBOYEkbjzl5HRiQvg/GQQBK7rwkgllNJ9yXw+n8mkt2zZ0pdO6TrkpfdAGPq6jjdJoIaBLAX0hoC48S6Q5cD3FVWPJus2895ZEWzz4vi+r6pUOGu1WiKRoK0UGQaVq1YtmUxMTs2+/MprF6YmE4lUNpvt788rgDwM8Yeua8/MzEwXJiuVSjbdt4vYaZokteMG0XWIanyxBtNeiOr0xaLMrBi2eXFs2zZNE+UWisabyEcUCAJJ0VRF/u+nnh6fOH/r3ts3bdq0bt0GqK9phk4oeAtoJLWEx6K4FwqFN996fXh4uFwu33vwnn37boeuCB66QjbHS6Z3AUCxphus8+phm5sSV2VMWHYNGQPbCY6+9faxZ599dnD3nrsP3JPqy8DDYslKJpOmGadfqBll6FBS57T0AmliYmpo+NTZMyPwfv/+/VvfvwUP0GRojRm+qceJnHbEwsTMrBS2eXHiqgzV4vjgeq6u6U8//T9vH/u/zz/88LYd21B3bdevOXbCTEFlx5EqFQtvAOiIkK2qCgq1YeimQaUajJ2bwv/F0szrr762e/fuwZ0700kD93i+p6sa7mKb1w7bvDgIA2gFGobmOB5ysKrKP/rRf42NjT36d9/MZtNuIFmWKymqkVB8Tzo7PuE7eHDCMKjKOp4XhPRXaPClE8n+jFZzpYQuWTUfy6xUS795/te333rrtm3b+jPUgxH3koZIMfEUs1rY5sWJN4rvY/OEmqb8+Mc/OX78+He/+11ZU2q2B03RHLRdCbW5OFu2PTedSCE6xwk4REswDB23ZllWX18f6vSGfBIlFxfbCRVVqpYrP//5z+7+yJ07d+zAwtH6Q0Vmm9cOb7+m2LaLkgwX//jHwy+++OK3v/3tqEVIfXb4Py4CCCTI1vlsfyqVgsO+74ahj7SARxp6IpvNInuAStXDw6nxp8uGKkPxhx763EuvvHJ2dDQIJcenZVETk1kbbPPiQFbT1CHY6OjYU0899eijj8YpAigyPtFowylSqMqKruGiYSYMjlMvKjP+R9KIArQKTW28M6jzmmpwDIS+++67Dx8+XCqVdU0m2Tkxrxm2eXF8Saq5aAhKP/3pzwYHB/fsGUSRRn6I+oQlOeqDU+VQVxVDU01dg9aqIlM3MvW7+YoUIECgFZhMJiG0C2xPQpaItjgWgqXt2rktn8+/+uqr9HRReaZ/zBpgmxcH5RW19p133h0eHv7Sl74E2xzHRfGl+fEFNiuyoSmmqmgKBKU6HTmNB9ESVDivSKmUmTR1yB94Lh0UjyIKVWGfupcPHDgwNDQ0Nj4RRZq4pjOrh21eHMiqqdKvfv38B2/bm8tlUY4RJ6Jj2SHqL+WKqMMYQqsUPKgSw11q0kVSR6khlAPJUKWEYZKpKPe+H/05LVzXFTT70un0TTfddPLkyThl+EjWzBrobpthzTz1WS0CyxsdnRg5c3bfvn3xzfknia8iKWncESRGgMYFFVpXVF3VcKEKTckhgLJUd3G354UBsnOAEAK3sd1d19M0GTHmzJkz1aqNZcZdIsyq6eLN13KDF+IF0ttH30FbbeeOXVHqgHwunhBa0viK6CIFPlIFXZA0EIShtUru1is04gV0pn43grr6QhhPOQQT0WA6kjefy+EtcX5stOVdGtHbr059luh0q80Newh+1KdaBNp5x949ceONN5q65Lme63imqbu+F5ViJZRhJ60AjI0lxuMjgalCU4ymNiJWEmsVRGZT116kFf0VuRyGiNNVq4ZgvXHjxvHxcczBGyZ68tbTI0J3pc3tVhlUPOlCYer6LZshpBoGuibVHEtWNU+WYBzyLUopXUI67Bf1MYeIywgZSBhhYOtaYGiyguAsB0gbMhqKWATCdtS4xPojb2A+3iHIyrn16yamJmlAnUbDQVtFw2bpBaG7z+YOqAymisWqXduwYUMYBKquIVfE/c0Ivz71r0maTu5quo6MER37C3Edei5iQyJhGJrqBy5qdtLQdMQLBdkjKuARmEa9lsNoEIgUpFIpGhUd9fq1ll4Tusts7ozKoFgouo6fy69DqKBvklBDDk8dGiiz0WhP1w1dz0c28FFdKfLSUH1N0yBytVyu1WqYBrbj12w38Gi0tI53BXVI0/JJcEXDggwVf2LECyG3W01PCd1NNndMZeC7HkqupCqhIpVrlqTIvufRF0ZCBATKFgHFDQQMtP501N/pyUnoGQUPOtaNVZ2ZLthVKwFbo29kBcDHMpCYser0FMjQXvT1FpqWZfjcJtF6R+iusfnyfYA5raW+3IiUmdRUo1KtIVeE0YhN2IhHICGgkUeVOPArljVVmB4bHR0eGsKssbExNObAyMhIsViEQ5h+59jx4dNDxdIMXDfJbIWsjiSG4IocjQX1/Lj3mhqN7aFHhO6ypNExsn0ZlNjpmVl4ZyQTHqIGgm8Q+p6Dsg05FE1NpJK5XG7TwObrN78vk8kMDAyk02nIms/nMYE0vOX6G7Zu3bp58+Z4Pv7O96PuPI0kRrpA6kZUQSzBwiPRLzoXv8FaSH25c1w+RwDY5sXJZVP92ezo+LjtUydGUB9ohAYcsi+NlbM9RGLKujQo3zRxl+vaG9ZvuOF9N6zLr4Mr8fdWAAowLngDgHmHaBq5GfcqyvT0dF9fXzyfWQtdYzN2f31qjkiPVlJfbkTSlLLZ7IWpaaTj2VIZzTzPp7Yg8jL1NNORPsIPAzQDAz/Udepcc1zHQsimb2E5SCmogGhKIhyjDANc4S4Smr5DRcdZoq8CyLAZz4WyLWS97CTdVJsbhGvrvkcp3jO4e+jU6cnCtOtJVdtXDc2BjbKiqDpkdVzfNBM1y0FTMTqQUj8FB9YK6sNdw6DB+4gQaPjBfiQNPAYxI275QWLbxmO0YrE6MzOzfft2/OHCFxS/wVpIfblzXD5HALosaTTsg/YJ7fnSrXt2Y+LkiVMVy67YTtEKFF2GiTXXc7ygWCz7AZ1sgFQO5VBWYTAeD2ddz1c1AyUbD3NQ0gk5wIVGbUR9fdSmlDSNhpeePXsWC9mwYUMkOi2hHTRsKCFVBl1mM+iM0BAtm9X3fnDPkRdesGx7bGLSCWUHliuI0XRw27Jq8BXFF1UajqIqS4rq+qGmGZ4X0LkIot5j13XJY1KZekWw6lTLUbxxnyLZXvj2saN79uzBXXgZ9bGkraZHVAbdZzPogNAyrHXCP/vEJ8+eGTk3PlGpOtNlGudmhZIjKSi4vhc6NRtltVqroTxjFaBvxapCSdfz3CBQNB1+Ix9j9SArEjaCMYUOOqhNPc6uL01FDA4O6rpm2za9JVpN76gMutJm0G6h0XZLGPINWzbccdvtR154EeadGB6phhKEdkKpWK6hAFfKlq5TLKagTBlDmS1VbNe3Pa9GpyKg9AyPvTB00MSLii+WjAfT4XE/UDXphcOHbxkcTPalcNM0zThSt5CeUhl0q82grUJHMYHOe/jQnz906hRag8OzZev0WBlOKgadUc5xvHK5ShkYqQO1OKTRF1gHx4G6vhQqXiChpQiV4ShmYm0VjUI2VhrzZU157/SZiYkLd9xxB9bbcmh8c2tt6zWVQRfbDNq3hzRNcT039MPN12X27z/wzjvHilX72ImT02Uab6+bSR+1uViybUlFSICsiMO6lsvlEJSxVslkEk26eIQnwgZsR8LGMrG6eCdYljU7W/rDC3888NF7Egnqq06nkpgZd/O1hB5UGXS3zaBN+wnJQKfRb3LgSl//6mdLhcnx0bMz07Mjo5OIz3qirxZIJcsuWzVSkL7ZSge900lKC3IgJ5MJqAxgFdaQzmGnqJKGjCFZrl+17TfeeMPQ9A/u3oWWIV4AdgPeAHEvXsvpEZVB19sMsLdi6rdbgqwh3eqaZGpSQpb+9q+/cPLNVzXPe/fo8emCFCZUPbt+olgulksJTdECT5aQg2XUYFPTfTQDHdR1OtACuUvViqJrniTT2GhZGjo/PTQ68ac337rvY/ei0ZfQ6BzOruPQc7Y0LMW0eLNc24hgc5tw3BqdS0AOQte7+8N7Dt754ddfOhI47tt/OlaqSpKe1JKZkfHzOnRUVc92dJUOX7s2JY3Ap7OM1qJuCsoV5YpuGii8I+cqM2XrD0eOHDx4cGDjesiL9iD+xxLwjC2szfTmjqjf7g3Y5sUJAzdlUFqAYYahQbgvPvx5U1VGR85MT10YGZtUjKQbKpOFUqnmS7KONh8eA3lklGhFc13fdnxZNWaLVeqkk1QzqVYrUnm2+OrL/7s+l7/11lshetzpgaeLbY67qJlVw5tvcehrUJJkGIYbjcW3nSCXUb/8lw+PnDpeLs4MDQ1dmJpB086T9fELhXQfIi/CseT7oaEnEI4rtm3hbyS5WLVCCeYnDF0qFIpnR0ZKM7P333dfwqRzICFaxB6D+GY8zawOtrkZIX0ZFfFZN4JQShiKbwf3fGTwtj23jJw+bVXt4ZHxku3PVNzRc9PQHS5aVs2D+ari0zESdbZknZuYMhNJtPlkWfFdqVQs/umtNz9+7z1bBjJ4IP4ExRjEeaDXUkE7YJubALdChFqajCNEQqcRnF/78hes8mylUnE8aXR8anK2OjI6Ua5JNIhfUQwTTUIa95zO9M1WypNTU4Gk+F6IGl+rSefHxxKa+uHbdoVBdGaZqCojbMQezxdpZtWwzc0IalZFVeWKBd3odAKB58qBtGm9uWfX9vHxcVXXZytWxQkmi9Wqgw2JmEBKq6qSyiQ1QyrMzBqJZHy8mrqfXWfs7Jk7931IVyQ6C3nUg+F50cB/jsstgrdjE3w3kUo7vpRIwk+qzZouS57tO9InPn6vbVVqtVoi1TdTKpeqdqFYcoBbc120BiVNk0oVv1Ao9K/r13VdVqJzMYZ+pTy7Y+vNUJl+Wi16EtTjeGwGUgeI5jGrh21uAv3SmRyN2SSoSUgDiRRDk7bftCUM3JC+B6WjzacnkhemCkE0KgPgcai+k1MT2f5MImFC5f7+rJlQC4WpTDq55bqc5wT0/e9I5/lmX5SfeV+sFd6CTaAzxRG4qhsHwhAimrp00/s2u3YlYaCwanA6m81RwpblZNKElBNTlZmZ6VQqkcv20Y8ABja9KwI3ldTRPjTphy+ZtsA2N4Gq5qUbBzMiDXVdyiRNybVShrJxXTaXyyF1QOJKxbJqNLpI05SB9Rs2X7dBlsNsXyqbTklBaFXLAwMbkb9d15Xo6ylM62GbmyDT2WAuKcyRzo7ro7QmdDmfTazLJDNJfct1m7LZbDqTymSydJYjXc6kkuvyOcxE0zFh6rqmJgzZs2uZNH2VlfIxd8a1B7a5GdgytHHqV4BkpjPaQsV8NlUuXNgykM/3JfuzKYQKQ5VS6RSad45DxTudNvOZTK6vD3cmdc1UJKtaNTU98Ggcs08/DMG0Hra5CdFA5JioPNMRETT1cAWbB3dtmz4/mjaUXdtufP8N2XyexuBrsqSrdEFITmpSLpPO9+nZJNJIxnaC6amZzZuvRwjBstTodDNMy6HxivVJZgELVK5nXOSDQFJqtq+bGmrrf/74mZHxifffvH3Dxs396VSfqa7P9SUMExnatu1KpYT/U32pvkwKc06dOplN9X304EdgseeEuh6f+ZZpMWzz4vjRx1ZclaMZuKLz12LCi77RXal63/z7x3cM7qb23qaNuZQh+/TbaojF2KRo6lWsquOS1hMTE5ZV+dd/+Sfq2PCi8zq34XSgDOCksTgLtgsm6QIDoSMusi+htlZmpmSv1qfL1+WTd39oz6FP3nn/p/bf/6m7H7jvwP2fPnjg4F03vP96XVcdx6mUyi6ihh8tJToXP/9cT5tgm1cA6mkQDbFA+u3Ppndsu9lQQuRjJXAdy3asWrVcGx07f/zE6eHh00gamUzmuoFNAwMb/uYrXwl833HoJ9uoLNM3qpjWw0ljceKNcnkciFuBcRH43e9fRKK4Y9++df3J0KPfsMK9k4WZwkzJ9X2Pzh2j27ZVKRXX5XJ7BrchZtAJ9unHUFyFjjUyLYZr88pAYcX7vxadUxFBwkIirlRmZiuYKFdqs2VMF2dmZiYnp8fHz4+MjAwNDR156UXU6eh7VXROOsRvhYfLtQe2eWX4Pv0iRMLUNE2F1qapJwwj15/OZJLpNA0F7evL5vP5gYGBzRHbtm3bu3evSr9PHNKvSmgahOYBRm2CbV6cZl0ONNQNKgZ0zrha1fJ9H1XZqgWlilOuOtVqrVQqXZgqTERMTk6gPJ84cULTFFWjM4J6Pp15kQcYtQnerCvD0Ol3AakqG2oCGGYyST/VahhGMmlkMolcLrcuYv36/Hr8y+d37Nhx7tw5vD3mPeba3CbY5pUBj+ElSrIcSrZTKxQKrk1jmxEfLMubLVmYg9wMpqenUZuLxZmRM0Nbt95MX7Ki2E3Nbq7NbYL7NMiweKJhU8zfWJg6IC599dULEH9feeU1Rdd27bxl3bqM69IgfS+QKpXauYkJ+IoCTCP4XXdmdrpWqTxw6NOBSw1HOjpOJ9lfvCHYbGWY5dDrNs/bA5Zjcwzucl3/+ed/g5R8y+49SBf9/f2GkbDs2oULF86fPz9VKOAuP3Bx8/XXX/vMoQe++pW/CjzH0A3XqeH90OxTcYn1Ya5IT9u8UB1wJZspKkBiXdcrlUo6nZ4tlp955hk09vbu3XvDTTemU32ox++eOP7SSy+999574+Pj0Hrz5s3f+MbX/+Lzn6UFhIFCv/RKX9Vejs2AhV4RvWvzFb1Z1GZYiEcCGIkH+H44OTn9xhtvVO3a4OAgLB8eHn7t1dd/9/vfVSrVBx984JFHHtm5/WY/gMOeqamO65i6gT9vljQAC71qetTm5RizwOaLXRB2rWbSj00ptm2bpolSremq70s//OG//fa3vz169GjNdU6ePPXgg4cef/wfPnbvQfqb6K9RjgPfVVXqpUYJV5c8FshCr45etHmZrixqMwh8f/64NP0pfTmKmnflcvXll19GXF4/sPGuu+7Cs1CTUdVUVfF8OjmdSce1pWKxmM1mmyWNeVjoVdBzNi/fkmY2ozwbZhLLCehgdaio2IaS49KvRiB+KLJiOzayNSbwYDpcomp4HOqxLNf75lzH0Y36rwkuAQu9UnrL5q7zg4VeEVf4vBOJbjSjYSUbXgLTQK/U5s6oPP8srV0+V+hlIkhtxv6Oqd++lIb5XWdDwwov8TJj6rd7D/GTRsPe7dLCtkyhexzBbRZD5RgW+oqIbLNIKsew0EsjrM3iqRzDQi+BmDaLqnIMC90MWfqPc/XJruZr18XXW5/+zKmHno2n63TyBc6tRieedP65Ii554WLs05UjWm2+mip3mEtfWuML70mE7tMQvkT1ag1uhrg298ieZqEXIKjNPbWPWeg55CfenahPdjOP7RqoTy2D9r3k+dVo+VNcIy/wGkfo3Mz0GGwzIw6CJI1rhPYlDWY5cG1mxIFtZsSBbWbEgW1mxIFtZsSBbWbEgW1mxIFt7hCP7RqIL/XbTBtgm1fJitRkiTsD27wmlqMpq9wx2Oa1srSsDffyEe+2wja3gGZCs8odhm1eJQ1qXi40q9x5eAzdmmhWlRvgjdwZuDavieVoyip3DLZ5rSwtK6vcSdjmFtBMWVa5w7DNreFycVnlzsM2t4yF+rLKVwXu02DEgWszIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIw5sMyMObDMjDmwzIwqS9P9GvvYgHpYhvAAAAABJRU5ErkJggg==" width="239" height="279" class="img_ev3q"></p>
<p>Le calcul d&#x27;éclairage est le même que pour une lumière directionnelle. Mais il nous faut d&#x27;abord calculer la direction de la lumière, qui cette fois-ci dépend de la position du pixel concerné. Il faut donc récupérer la position dans le fragment shader, puis calculer le vecteur entre la position du pixel et la position de la lumière. De plus, l&#x27;intensité d&#x27;une lumière ponctuelle décroît à mesure qu&#x27;on s&#x27;en éloigne, donc il faut diviser le tout par la distance au carré<sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>.</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-27-b0eb124335371ac036b144c7146c60aa.png" width="1920" height="1030" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>astuce</div><div class="admonitionContent_BuS1"><p>Pour contrôler l&#x27;influence des différentes lumières, vous pouvez leur rajouter une intensité (a.k.a. un nombre que vous allez multiplier au résultat du produit scalaire) afin d&#x27;augmenter ou diminuer l&#x27;effet d&#x27;une lumière.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="normal-matrix-et-model-matrix">Normal Matrix et Model Matrix<a href="#normal-matrix-et-model-matrix" class="hash-link" aria-label="Lien direct vers Normal Matrix et Model Matrix" title="Lien direct vers Normal Matrix et Model Matrix">​</a></h3>
<p>Si on se met à appliquer une matrice modèle à notre objet, par exemple pour le faire tourner, on se rend compte d&#x27;un petit problème :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-28-incorrect-532636420dc4ac87f28e152f97034bee.gif" width="1271" height="714" class="img_ev3q"></p>
<p>L&#x27;éclairage ne prend pas en compte la transformation de notre objet ! C&#x27;est comme si il ne tournait pas aux yeux de la lumière ! C&#x27;est parce que les positions et normales qu&#x27;on récupère depuis le vertex buffer sont exprimées en Object Space, alors que la position / direction de notre lumière est en World Space. Pour pouvoir faire nos calculs il faut que tout soit exprimé dans le même repère ! Pour convertir les positions et normales de nos pixels depuis l&#x27;Object Space vers le World Space, il faut leur appliquer la Model Matrix. Et je vous donne ces deux fonctions pour appliquer correctement une matrice à une position et à une direction en prenant bien en compte les coordonnées homogènes :</p>
<div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">vec3</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apply_matrix_to_position</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">mat4</span><span class="token plain"> matrix</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec3</span><span class="token plain"> point</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">vec4</span><span class="token plain"> tmp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> matrix </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">point</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xyz </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">vec3</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apply_matrix_to_direction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">mat4</span><span class="token plain"> matrix</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec3</span><span class="token plain"> direction</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">vec4</span><span class="token plain"> tmp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> matrix </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">direction</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">normalize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xyz</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-28-correct-754ce01e25666b9c5d69a534ec8bce93.gif" width="1270" height="712" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>astuce</div><div class="admonitionContent_BuS1"><p>Pour éviter toute confusion à l&#x27;avenir, je vous conseille de toujours ajouter un petit suffixe à vos variables de position et direction, pour bien indiquer dans quel espace elles sont exprimées : par exemple <code>_os</code> pour object space, <code>_ws</code> pour world space, <code>_vs</code> pour view space, etc.</p><div class="language-glsl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-glsl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">location </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec3</span><span class="token plain"> in_position_os</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">uniform</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">mat4</span><span class="token plain"> model_matrix</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">out</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">vec3</span><span class="token plain"> position_ws</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    position_ws </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apply_matrix_to_position</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_matrix</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> in_position_os</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<p>De plus, ce n&#x27;est pas tout à fait la Model Matrix qu&#x27;il faut appliquer aux normales, mais la <strong>Normal Matrix</strong>, qui est l&#x27;inverse de la transposée de la Model Matrix (<code>glm::inverse(glm::transpose(model_matrix))</code>). Ça revient au même dans la plupart des cas, mais si jamais il y a une scale non-uniforme dans votre model matrix, alors ça déformerait les normales et il faut passer par la Normal Matrix pour corriger ça.</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/normal-matrix-6a3052eb71ed34fcd177743745caf4bb.png" width="550" height="325" class="img_ev3q"><br>
<em>Normales incorrectement transformées par la Model Matrix</em></p>
<p>Si vous voulez savoir d&#x27;où vient la normal matrix et pourquoi c&#x27;est l&#x27;inverse de la transposée, je vous recommande <a href="http://www.lighthouse3d.com/tutorials/glsl-12-tutorial/the-normal-matrix/" target="_blank" rel="noopener noreferrer">ce petit article</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lumières-colorées">Lumières colorées<a href="#lumières-colorées" class="hash-link" aria-label="Lien direct vers Lumières colorées" title="Lien direct vers Lumières colorées">​</a></h3>
<p>On peut aussi associer une couleur à chaque lumière, simplement en multipliant sa contribution par la couleur désirée (<code>vec3</code>) :</p>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/step-29-812852ae42cde76d879fe14dd1d2f84e.png" width="1920" height="1030" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="à-vous-de-jouer-">À vous de jouer !<a href="#à-vous-de-jouer-" class="hash-link" aria-label="Lien direct vers À vous de jouer !" title="Lien direct vers À vous de jouer !">​</a></h2>
<p>Voici différents effets &quot;avancés&quot; que vous pouvez implémenter maintenant que vous connaissez les bases du rendu 3D !</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="normal-maps">Normal maps<a href="#normal-maps" class="hash-link" aria-label="Lien direct vers Normal maps" title="Lien direct vers Normal maps">​</a></h3>
<p>Les normal maps permettent d&#x27;ajouter du détail à un mesh en modifiant la normale pour chaque pixel du triangle. <a href="https://learnopengl.com/Advanced-Lighting/Normal-Mapping" target="_blank" rel="noopener noreferrer">Voici par exemple un tuto que vous pouvez suivre pour implémenter des normal maps.</a> <a href="https://youtu.be/JNj1A1bl7gg?list=PLPaoO-vpZnumdcb4tZc4x5Q-v7CkrQ6M-" target="_blank" rel="noopener noreferrer">Et le même en version vidéo.</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ombres">Ombres<a href="#ombres" class="hash-link" aria-label="Lien direct vers Ombres" title="Lien direct vers Ombres">​</a></h3>
<p>Les shadow maps permettent de produire des ombres <strong>pour les lumières directionnelles</strong>. C&#x27;est le point de départ de toute une famille de technique plus raffinées, comme les <em>omnidirectional shadow maps</em> qui gèrent les lumières ponctuelles, et les <em>cascaded shadow maps</em> qui améliorent la qualité des ombres. <a href="https://learnopengl.com/Advanced-Lighting/Shadows/Shadow-Mapping" target="_blank" rel="noopener noreferrer">Voici par exemple un tuto que vous pouvez suivre pour implémenter une shadow map basique.</a> (Et vous verrez, c&#x27;est déjà un peu costaud !) <a href="https://youtu.be/9g-4aJhCnyY?list=PLPaoO-vpZnumdcb4tZc4x5Q-v7CkrQ6M-" target="_blank" rel="noopener noreferrer">Et le même tuto en version vidéo.</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="effet-see-through">Effet see-through<a href="#effet-see-through" class="hash-link" aria-label="Lien direct vers Effet see-through" title="Lien direct vers Effet see-through">​</a></h3>
<p>Pour faire cette effet où on voit une silhouette des objets à travers les murs, il vous suffit, une fois toute la scène rendue normalement, de redessiner une deuxième fois l&#x27;objet sur lequel vous voulez appliquer l&#x27;effet, avec ce setup particulier :</p>
<ul>
<li>Appliquer un shader spécial qui va donner le visuel de la silhouette, par exemple retourner une couleur unie pour faire simple</li>
<li>Changer le depth test, pour que l&#x27;objet ne s&#x27;affiche que si il est derrière d&#x27;autres objets. Je vous réfère à la documentation de <a href="https://registry.khronos.org/OpenGL-Refpages/gl4/html/glDepthFunc.xhtml" target="_blank" rel="noopener noreferrer"><code>glDepthFunc</code></a> pour voir comment faire ça.</li>
</ul>
<p><img decoding="async" loading="lazy" src="/Rendering/assets/images/see-through-bf42b78a4b1170ec204d66eaed824a8a.png" width="1437" height="883" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="matériaux-et-modèles-déclairages-plus-avancés">Matériaux et modèles d&#x27;éclairages plus avancés<a href="#matériaux-et-modèles-déclairages-plus-avancés" class="hash-link" aria-label="Lien direct vers Matériaux et modèles d&#x27;éclairages plus avancés" title="Lien direct vers Matériaux et modèles d&#x27;éclairages plus avancés">​</a></h3>
<p>Je vous réfère à ces tutos :</p>
<ul>
<li><a href="https://learnopengl.com/Lighting/Basic-Lighting" target="_blank" rel="noopener noreferrer">Basic Lighting</a>, il y a un peu de redite de ce qu&#x27;on a vu, mais aussi des nouveautés</li>
<li><a href="https://learnopengl.com/Lighting/Materials" target="_blank" rel="noopener noreferrer">Materials</a></li>
<li><a href="https://learnopengl.com/Advanced-Lighting/Advanced-Lighting" target="_blank" rel="noopener noreferrer">Blinn-Phong</a></li>
<li><a href="https://learnopengl.com/PBR/Theory" target="_blank" rel="noopener noreferrer">PBR part 1</a></li>
<li><a href="https://learnopengl.com/PBR/Lighting" target="_blank" rel="noopener noreferrer">PBR part 2</a></li>
</ul>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Lien direct vers Footnotes" title="Lien direct vers Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-1">
<p>C&#x27;est dû au principe physique de conservation d&#x27;énergie : à un instant <em>t</em> la source émet une certaine quantit é d&#x27;énergie, et cette énergie s&#x27;éloigne de la source, formant une sphère de plus en plus grande. Comme la même quantité d&#x27;énergie doit être présente sur une sphère de plus en plus grande, l&#x27;énergie en un point donné doit décroître proportionnellement à la surface de la sphère, soit <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>R</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">R^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>. <a href="#user-content-fnref-1" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pages de documentation"><a class="pagination-nav__link pagination-nav__link--prev" href="/Rendering/M1 GP/Partie 2 - Bases du rendu"><div class="pagination-nav__sublabel">Précédent</div><div class="pagination-nav__label">Partie 2 - Bases du rendu</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#charger-un-mesh-depuis-un-fichier" class="table-of-contents__link toc-highlight">Charger un mesh depuis un fichier</a></li><li><a href="#premier-modèle-déclairage-et-normales" class="table-of-contents__link toc-highlight">Premier modèle d&#39;éclairage et Normales</a><ul><li><a href="#normales" class="table-of-contents__link toc-highlight">Normales</a></li><li><a href="#lumière-directionnelle" class="table-of-contents__link toc-highlight">Lumière directionnelle</a></li><li><a href="#lumière-ambiante" class="table-of-contents__link toc-highlight">Lumière ambiante</a></li><li><a href="#lumière-ponctuelle" class="table-of-contents__link toc-highlight">Lumière ponctuelle</a></li><li><a href="#normal-matrix-et-model-matrix" class="table-of-contents__link toc-highlight">Normal Matrix et Model Matrix</a></li><li><a href="#lumières-colorées" class="table-of-contents__link toc-highlight">Lumières colorées</a></li></ul></li><li><a href="#à-vous-de-jouer-" class="table-of-contents__link toc-highlight">À vous de jouer !</a><ul><li><a href="#normal-maps" class="table-of-contents__link toc-highlight">Normal maps</a></li><li><a href="#ombres" class="table-of-contents__link toc-highlight">Ombres</a></li><li><a href="#effet-see-through" class="table-of-contents__link toc-highlight">Effet see-through</a></li><li><a href="#matériaux-et-modèles-déclairages-plus-avancés" class="table-of-contents__link toc-highlight">Matériaux et modèles d&#39;éclairages plus avancés</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Pour me contacter :</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.com/users/372812330742054914" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="mailto:jules.fouchy@ntymail.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">E-Mail</a></li></ul></div></div></div></footer></div>
</body>
</html>